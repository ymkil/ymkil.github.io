<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="ã€å‰è¨€ã€‘ä»iOS7å‡åˆ°iOS8åï¼ŒGCD å‡ºç°äº†ä¸€ä¸ªé‡å¤§çš„å˜åŒ–ï¼šåœ¨ iOS7 æ—¶ï¼Œä½¿ç”¨ GCD çš„å¹¶è¡Œé˜Ÿåˆ—ï¼Œ  dispatch_async  æœ€å¤§å¼€å¯çš„çº¿ç¨‹ä¸€ç›´èƒ½æ§åˆ¶åœ¨6ã€7æ¡ï¼Œçº¿ç¨‹æ•°éƒ½æ˜¯ä¸ªä½æ•°ï¼Œç„¶è€Œ iOS8åï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸€åº¦å¯ä»¥è¾¾åˆ°40æ¡ã€50æ¡ã€‚ç„¶è€Œåœ¨æ–‡æ¡£ä¸Šå¹¶æ²¡æœ‰å¯¹è¿™ä¸€åšæ³•çš„ç›®çš„è¿›è¡Œä»‹ç»ã€‚
ç¬”è€…æ¨æµ‹ Apple çš„ç›®çš„æ˜¯æƒ³å€Ÿæ­¤è®©å¼€å‘è€…ä½¿ç”¨ NSOperationQueue ï¼šGCD ä¸­ A">
<meta property="og:type" content="article">
<meta property="og:title" content="Parseçš„åº•å±‚å¤šçº¿ç¨‹å¤„ç†æ€è·¯ï¼šGCDé«˜çº§ç”¨æ³•">
<meta property="og:url" content="http://mkiltech.com/blog/2016/09/gcd-advanced.html">
<meta property="og:site_name" content="Mkil-å°èš‚èš">
<meta property="og:description" content="ã€å‰è¨€ã€‘ä»iOS7å‡åˆ°iOS8åï¼ŒGCD å‡ºç°äº†ä¸€ä¸ªé‡å¤§çš„å˜åŒ–ï¼šåœ¨ iOS7 æ—¶ï¼Œä½¿ç”¨ GCD çš„å¹¶è¡Œé˜Ÿåˆ—ï¼Œ  dispatch_async  æœ€å¤§å¼€å¯çš„çº¿ç¨‹ä¸€ç›´èƒ½æ§åˆ¶åœ¨6ã€7æ¡ï¼Œçº¿ç¨‹æ•°éƒ½æ˜¯ä¸ªä½æ•°ï¼Œç„¶è€Œ iOS8åï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸€åº¦å¯ä»¥è¾¾åˆ°40æ¡ã€50æ¡ã€‚ç„¶è€Œåœ¨æ–‡æ¡£ä¸Šå¹¶æ²¡æœ‰å¯¹è¿™ä¸€åšæ³•çš„ç›®çš„è¿›è¡Œä»‹ç»ã€‚
ç¬”è€…æ¨æµ‹ Apple çš„ç›®çš„æ˜¯æƒ³å€Ÿæ­¤è®©å¼€å‘è€…ä½¿ç”¨ NSOperationQueue ï¼šGCD ä¸­ A">
<meta property="og:image" content="http://i65.tinypic.com/2vj1md2.jpg">
<meta property="og:image" content="http://i66.tinypic.com/34g8qd1.jpg">
<meta property="og:image" content="http://i61.tinypic.com/6thjmf.jpg">
<meta property="og:image" content="http://i59.tinypic.com/suyt0o.jpg">
<meta property="og:image" content="http://i61.tinypic.com/33m06er.jpg">
<meta property="og:image" content="http://i67.tinypic.com/29vxt9w.jpg">
<meta property="og:updated_time" content="2016-09-27T11:27:48.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Parseçš„åº•å±‚å¤šçº¿ç¨‹å¤„ç†æ€è·¯ï¼šGCDé«˜çº§ç”¨æ³•">
<meta name="twitter:description" content="ã€å‰è¨€ã€‘ä»iOS7å‡åˆ°iOS8åï¼ŒGCD å‡ºç°äº†ä¸€ä¸ªé‡å¤§çš„å˜åŒ–ï¼šåœ¨ iOS7 æ—¶ï¼Œä½¿ç”¨ GCD çš„å¹¶è¡Œé˜Ÿåˆ—ï¼Œ  dispatch_async  æœ€å¤§å¼€å¯çš„çº¿ç¨‹ä¸€ç›´èƒ½æ§åˆ¶åœ¨6ã€7æ¡ï¼Œçº¿ç¨‹æ•°éƒ½æ˜¯ä¸ªä½æ•°ï¼Œç„¶è€Œ iOS8åï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸€åº¦å¯ä»¥è¾¾åˆ°40æ¡ã€50æ¡ã€‚ç„¶è€Œåœ¨æ–‡æ¡£ä¸Šå¹¶æ²¡æœ‰å¯¹è¿™ä¸€åšæ³•çš„ç›®çš„è¿›è¡Œä»‹ç»ã€‚
ç¬”è€…æ¨æµ‹ Apple çš„ç›®çš„æ˜¯æƒ³å€Ÿæ­¤è®©å¼€å‘è€…ä½¿ç”¨ NSOperationQueue ï¼šGCD ä¸­ A">
<meta name="twitter:image" content="http://i65.tinypic.com/2vj1md2.jpg">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6328495837512992000,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://mkiltech.com/blog/2016/09/gcd-advanced.html"/>

  <title> Parseçš„åº•å±‚å¤šçº¿ç¨‹å¤„ç†æ€è·¯ï¼šGCDé«˜çº§ç”¨æ³• | Mkil-å°èš‚èš </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Mkil-å°èš‚èš</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Parseçš„åº•å±‚å¤šçº¿ç¨‹å¤„ç†æ€è·¯ï¼šGCDé«˜çº§ç”¨æ³•
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2016-09-27T19:21:50+08:00" content="2016-09-27">
              2016-09-27
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/blog/2016/09/gcd-advanced.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="/blog/2016/09/gcd-advanced.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>ã€å‰è¨€ã€‘ä»iOS7å‡åˆ°iOS8åï¼ŒGCD å‡ºç°äº†ä¸€ä¸ªé‡å¤§çš„å˜åŒ–ï¼šåœ¨ iOS7 æ—¶ï¼Œä½¿ç”¨ GCD çš„å¹¶è¡Œé˜Ÿåˆ—ï¼Œ  <code>dispatch_async</code>  æœ€å¤§å¼€å¯çš„çº¿ç¨‹ä¸€ç›´èƒ½æ§åˆ¶åœ¨6ã€7æ¡ï¼Œçº¿ç¨‹æ•°éƒ½æ˜¯ä¸ªä½æ•°ï¼Œç„¶è€Œ iOS8åï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸€åº¦å¯ä»¥è¾¾åˆ°40æ¡ã€50æ¡ã€‚ç„¶è€Œåœ¨æ–‡æ¡£ä¸Šå¹¶æ²¡æœ‰å¯¹è¿™ä¸€åšæ³•çš„ç›®çš„è¿›è¡Œä»‹ç»ã€‚</p>
<p>ç¬”è€…æ¨æµ‹ Apple çš„ç›®çš„æ˜¯æƒ³å€Ÿæ­¤è®©å¼€å‘è€…ä½¿ç”¨ <code>NSOperationQueue</code> ï¼šGCD ä¸­ Apple å¹¶æ²¡æœ‰æä¾›æ§åˆ¶å¹¶å‘æ•°é‡çš„æ¥å£ï¼Œè€Œ  <code>NSOperationQueue</code>  æœ‰ã€‚GCD æ²¡æœ‰æä¾›æš‚åœã€æ¢å¤ã€å–æ¶ˆé˜Ÿåˆ—ä»»åŠ¡çš„æ¥å£ï¼Œè€Œ  <code>NSOperationQueue</code>  æœ‰ï¼Œå¦‚æœæƒ³è®© GCD æ”¯æŒ <code>NSOperationQueue</code> åŸç”Ÿå°±æ”¯æŒçš„åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨è®¸å¤šGCD çš„é«˜çº§åŠŸèƒ½ï¼Œå¤§å¤§æé«˜äº†ä½¿ç”¨çš„éš¾åº¦ã€‚</p>
<p> <code>Apple</code>  å§‹ç»ˆæœ‰ä¸€ä¸ªè§‚å¿µï¼šå°½å¯èƒ½é€‰ç”¨é«˜å±‚ APIï¼Œåªåœ¨ç¡®æœ‰å¿…è¦æ—¶æ‰æ±‚åŠ©äºåº•å±‚ã€‚ç„¶è€Œå¼€å‘è€…å¹¶ä¸ä¹°è´¦ï¼Œåœ¨æˆ‘è¿›è¡Œçš„ä¸€æ¬¡ <a href="http://weibo.com/1692391497/D1pKjqaiW?type=comment" target="_blank" rel="external">è°ƒæŸ¥</a> ä¸­å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼š</p>
<p>å¤§æ¦‚ 80%çš„iOS å¼€å‘è€…ä¼šæ”¯æŒä½¿ç”¨ GCD æ¥å®Œæˆæ“ä½œé˜Ÿåˆ—çš„å®ç°ï¼Œè€Œä¸”æœ‰ 60% çš„å¼€å‘å·²ç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>
<p><img src="http://i65.tinypic.com/2vj1md2.jpg" alt="enter image description here"></p>
<p>æ›´æ˜¯æœ‰äººè¿™æ ·è¡¨æ€ï¼š</p>
<p>å‡å¦‚ä¸è®©ä»–ç”¨ GCDï¼š</p>
<p><img src="http://i66.tinypic.com/34g8qd1.jpg" alt="enter image description here"></p>
<p>è¿™ç§ç°è±¡ä¸€ç›´å­˜åœ¨ï¼ŒåŒ…æ‹¬ ARC ä¸ MRCã€SBå»º UI ä¸çº¯ä»£ç å»º UIã€SQL ä¸ CoreDataçš„äº‰è®ºã€‚</p>
<p>ä½†æ˜¯å› ä¸ºæ˜¯æºç è§£æçš„æ–‡ç« ï¼Œè€Œ Parse çš„ SDK æ²¡æœ‰ç”¨ä¸€å¥çš„ NSOperation çš„ä»£ç ï¼ŒGCD ä¸€è·¯ç”¨åˆ°åº•ï¼Œè®©æˆ‘ä¹Ÿååˆ†éœ‡æƒŠã€‚åªèƒ½è¯´æ˜ï¼Œå†™  <code>Parse</code>  çš„è¿™ä½å¼€å‘è€…æ˜¯è‰ºé«˜äººèƒ†å¤§ã€‚è€Œä¸”æ—¢ç„¶  <code>GCD</code>  çš„æ”¯æŒè€…å¦‚æ­¤ä¹‹å¤šï¼Œé‚£ä¹ˆå°±è°ˆä¸€è°ˆå¦‚ä½•è®© GCD èƒ½æ”¯æŒ <code>NSOperationQueue</code> åŸç”Ÿå°±æ”¯æŒçš„åŠŸèƒ½ã€‚</p>
<p>ä»Šå¤©è™½ç„¶è°ˆäº†NSOperationåŸç”ŸåŠŸèƒ½çš„ GCD ç‰ˆæœ¬å®ç°ï¼Œä½†å¹¶ä¸ä»£è¡¨æˆ‘æ”¯æŒåƒ Parse è¿™æ · GCD ä¸€è·¯ç”¨åˆ°åº•ã€‚ ä¸šå†…ä¸€èˆ¬çš„çœ‹æ³•æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p> <code>GCD</code> è™½ç„¶èƒ½å¤Ÿå®ç°æš‚åœå’Œç»ˆæ­¢ï¼Œä½†å¼€å‘è¿˜æ˜¯çµæ´»äº›å¥½ï¼Œé‚£äº› <code>NSOperation</code> ç”¨èµ·æ¥æ–¹ä¾¿çš„å°±ç›´æ¥ç”¨ <code>NSOperation</code> çš„æ–¹å¼ï¼Œä¸ç„¶è‹¹æœå¤šåŒ…é‚£ä¸€å±‚ä¸æ˜¯è›‹ç–¼ï¼ŒåŒ…æ‹¬æ–‡ç« é‡Œæåˆ°çš„ <code>iOS8</code> åæ§åˆ¶çº¿ç¨‹æ•°çš„é—®é¢˜ï¼Œä¸ä¸€å®šé¡¹ç›®å°±ä¸€å®šè¦GCDä¸€è·¯åˆ°åº•ã€‚æœ‰æ—¶å€™éœ€è¦æ”¯æŒä¸€äº›é«˜å±‚çº§å°è£…åŠŸèƒ½æ¯”å¦‚ï¼š <code>KVO</code> æ—¶ <code>NSOperation</code> è¿˜æ˜¯æœ‰å®ƒçš„ä¼˜åŠ¿çš„ã€‚ <code>GCD</code> åè€Œæ˜¯å¤„ç†äº›æ¯”è¾ƒç®€å•çš„æ“ä½œæˆ–è€…æ˜¯è¾ƒç³»ç»Ÿçº§çš„æ¯”å¦‚ï¼šç›‘è§†è¿›ç¨‹æˆ–è€…ç›‘è§†æ–‡ä»¶å¤¹å†…æ–‡ä»¶çš„å˜åŒ–ä¹‹ç±»çš„æ¯”è¾ƒåˆé€‚ã€‚</p>
</blockquote>
<p>ï¼ˆiOSå¼€å‘å­¦ä¹ äº¤æµç¾¤ï¼š541317935ï¼‰</p>
<p>ç¬¬ä¸€ç¯‡çš„ç›®çš„æ˜¯é€šè¿‡è§£è¯» Parse æºç æ¥å±•ç¤ºGCDä¸¤ä¸ªé«˜çº§ç”¨æ³•ï¼š <code>Dispatch Source</code> ï¼ˆæ´¾å‘æºï¼‰å’Œ <code>Dispatch Semaphore</code>  ï¼ˆä¿¡å·é‡ï¼‰ã€‚é¦–å…ˆé€šè¿‡Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œï¼Œæ¥ä»‹ç» <code>Dispatch Source</code> ï¼ˆæ´¾å‘æºï¼‰ï¼›ç„¶åé€šè¿‡Parse çš„å•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨çš„æŠ€å·§â€œå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•â€æ¥ä»‹ç»<code>Dispatch Semaphore</code>  ï¼ˆä¿¡å·é‡ï¼‰ã€‚æˆ‘å·²å°†æ€è·¯æµ“ç¼©ä¸ºå¯è¿è¡Œçš„7ä¸ª Demo ä¸­ï¼Œè¯¦è§ä»“åº“é‡Œçš„ Demo1åˆ° Demo7ã€‚</p>
<p>å¦‚æœå¯¹ GCD ä¸å¤ªç†Ÿæ‚‰ï¼Œè¯·å…ˆè¯»ä¸‹<a href="http://mkiltech.com/blog/2016/09/gcd-base.html">ã€ŠGCD åŸºç¡€ç¯‡ã€‹</a>ã€‚</p>
<h2 id="Parse-iOS-SDKä»‹ç»"><a href="#Parse-iOS-SDKä»‹ç»" class="headerlink" title="Parse-iOS-SDKä»‹ç»"></a>Parse-iOS-SDKä»‹ç»</h2><p> <a href="http://www.infoq.com/cn/news/2015/08/ios-weekly-ios841#rd" target="_blank" rel="external">ã€ŠiOSå¼€å‘å‘¨æŠ¥ï¼šiOS 8.4.1 å‘å¸ƒï¼ŒiOS 8 æ—¶ä»£è°¢å¹•ã€‹</a> å¯¹ Facebook æ——ä¸‹çš„ Parseæœ‰è¿™æ ·ä¸€æ®µä»‹ç»ï¼š</p>
<blockquote>
<p>Parse-SDK-iOS-OSXï¼šè‘—åçš„ BaaS å…¬å¸ Parse æœ€è¿‘å¼€æºäº†å®ƒä»¬çš„ iOS/OSX SDKã€‚Parse çš„æœåŠ¡è™½ç„¶åœ¨å›½å†…å¯èƒ½è®¿é—®é€Ÿåº¦ä¸æ˜¯å¾ˆç†æƒ³ï¼Œä½†æ˜¯å®ƒä»¬åœ¨æœåŠ¡çš„ç¨³å®šæ€§å’Œ SDK è´¨é‡ä¸Šä¸€ç›´æœ‰éå¸¸ä¼˜å¼‚çš„è¡¨ç°ã€‚æ­¤æ¬¡å¼€æºçš„ SDK å¯¹äºæ—¥å¸¸å·¥ä½œæ˜¯ SDK å¼€å‘çš„å¼€å‘è€…æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªéš¾å¾—çš„å­¦ä¹ æœºä¼šã€‚Parse çš„å­˜å–æ“ä½œæ¶‰åŠåˆ°å¾ˆå¤šå¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œä» Parse SDK çš„æºä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ª SDK çš„å¼€å‘è€…å¯¹ iOS å¼€å‘å¤šçº¿ç¨‹æœ‰ç€éå¸¸æ·±åšçš„ç†è§£å’ŒåŠŸåº•ï¼Œè®©äººå¹æœã€‚æˆ‘ä¸ªäººæ¨èå¯¹æ­¤æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å°è¯•ä»é˜…è¯» internal æ–‡ä»¶å¤¹ä¸‹çš„ä¸¤ä¸ªEventuallyQueue æ–‡ä»¶å¼€å§‹ç€æ‰‹ï¼Œç ”ç©¶ä¸‹ Parse çš„åº•å±‚å¤šçº¿ç¨‹å¤„ç†æ€è·¯ã€‚</p>
</blockquote>
<p>ç±»ä¼¼çš„æœåŠ¡ï¼š<br> Apple çš„ <a href="http://nshipster.cn/cloudkit/" target="_blank" rel="external">Cloudâ€‹Kit</a> ã€ å›½å†…çš„ <a href="https://leancloud.cn/?source=T6M35E4H" target="_blank" rel="external">LeanCloudï¼ˆåŸå <code>AVOS</code> ï¼‰</a> ã€‚</p>
<h2 id="Parse-çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»"><a href="#Parse-çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»" class="headerlink" title="Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»"></a>Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»</h2><p>å¤§å¤šæ•°ä¿å­˜åŠŸèƒ½å¯ä»¥ç«‹åˆ»æ‰§è¡Œï¼Œå¹¶é€šçŸ¥åº”ç”¨â€œä¿å­˜å®Œæ¯•â€ã€‚ä¸è¿‡è‹¥ä¸éœ€è¦çŸ¥é“ä¿å­˜å®Œæˆçš„æ—¶é—´ï¼Œåˆ™å¯ä½¿ç”¨â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œï¼ˆsaveEventually æˆ– deleteEventuallyï¼‰ æ¥ä»£æ›¿ï¼Œä¹Ÿå°±æ˜¯ï¼š</p>
<p>å¦‚æœç”¨æˆ·ç›®å‰å°šæœªæ¥å…¥ç½‘ç»œï¼Œâ€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œï¼ˆsaveEventually æˆ– deleteEventuallyï¼‰ ä¼šç¼“å­˜è®¾å¤‡ä¸­çš„æ•°æ®ï¼Œå¹¶åœ¨ç½‘ç»œè¿æ¥æ¢å¤åä¸Šä¼ ã€‚å¦‚æœåº”ç”¨åœ¨ç½‘ç»œæ¢å¤ä¹‹å‰å°±è¢«å…³é—­äº†ï¼Œé‚£ä¹ˆå½“å®ƒä¸‹ä¸€æ¬¡æ‰“å¼€æ—¶ï¼ŒSDK ä¼šè‡ªåŠ¨å†æ¬¡å°è¯•ä¿å­˜æ“ä½œã€‚</p>
<p>æ‰€æœ‰ saveEventuallyï¼ˆæˆ– deleteEventuallyï¼‰çš„ç›¸å…³è°ƒç”¨ï¼Œå°†æŒ‰ç…§è°ƒç”¨çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚å› æ­¤ï¼Œå¤šæ¬¡å¯¹æŸä¸€å¯¹è±¡ä½¿ç”¨ saveEventually æ˜¯å®‰å…¨çš„ã€‚</p>
<p>å›½å†…çš„ <a href="https://leancloud.cn/?source=T6M35E4H" target="_blank" rel="external">LeanCloudï¼ˆåŸå <code>AVOS</code> ï¼‰</a> ä¹Ÿæä¾›äº†ç›¸åŒçš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä»¥ä¸Šã€ŠParse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»ã€‹éƒ¨åˆ†å®Œå…¨æ‘˜å½•è‡ª LeanCloud çš„æ–‡æ¡£ã€‚è¯¦è§<a href="https://leancloud.cn/docs/ios_os_x_guide.html#ç¦»çº¿å­˜å‚¨å¯¹è±¡" target="_blank" rel="external">ã€ŠLeanCloudå®˜æ–¹æ–‡æ¡£-iOS / OS X æ•°æ®å­˜å‚¨å¼€å‘æŒ‡å—â€“ç¦»çº¿å­˜å‚¨å¯¹è±¡ã€‹</a> </p>
<p>ï¼ˆåˆ©ç›Šç›¸å…³å£°æ˜ï¼šæœ¬äººç›®å‰å°±èŒäº <a href="https://leancloud.cn/?source=T6M35E4H" target="_blank" rel="external">LeanCloudï¼ˆåŸå <code>AVOS</code> ï¼‰</a> ï¼‰</p>
<h2 id="Parse-çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€å®ç°ä»‹ç»"><a href="#Parse-çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€å®ç°ä»‹ç»" class="headerlink" title="Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€å®ç°ä»‹ç»"></a>Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€å®ç°ä»‹ç»</h2><p>Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œï¼ˆsaveEventually æˆ– deleteEventuallyï¼‰ æ˜¯é€šè¿‡ GCD çš„ <code>Dispatch Source</code> ï¼ˆä¿¡å·æºï¼‰æ¥å®ç°çš„ã€‚ä¸‹é¢å¯¹ <code>Dispatch Source</code> ï¼ˆä¿¡å·æºï¼‰è¿›è¡Œä¸€ä¸‹ä»‹ç»ï¼š</p>
<p>GCDä¸­é™¤äº†ä¸»è¦çš„ <code>Dispatch Queue</code> å¤–ï¼Œè¿˜æœ‰ä¸å¤ªå¼•äººæ³¨ç›®çš„ <code>Dispatch Source</code> .å®ƒæ˜¯BSDç³»å†…æ ¸æƒ¯æœ‰åŠŸèƒ½kqueueçš„åŒ…è£…ã€‚kqueue æ˜¯åœ¨ XNU å†…æ ¸ä¸­å‘ç”Ÿå„ç§äº‹ä»¶æ—¶ï¼Œåœ¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ–¹æ‰§è¡Œå¤„ç†çš„æŠ€æœ¯ã€‚å…¶ CPU è´Ÿè·éå¸¸å°ï¼Œå°½é‡ä¸å ç”¨èµ„æºã€‚kqueue å¯ä»¥è¯´æ˜¯åº”ç”¨ç¨‹åºå¤„ç† XNU å†…æ ¸ä¸­å‘ç”Ÿçš„å„ç§äº‹ä»¶çš„æ–¹æ³•ä¸­æœ€ä¼˜ç§€çš„ä¸€ç§ã€‚</p>
<p> <code>Dispatch Source</code> ä¹Ÿä½¿ç”¨åœ¨äº† Core Foundation æ¡†æ¶çš„ç”¨äºå¼‚æ­¥ç½‘ç»œçš„API  <code>CFSocket</code> ä¸­ã€‚å› ä¸ºFoundation æ¡†æ¶çš„å¼‚æ­¥ç½‘ç»œ API æ˜¯é€šè¿‡CFSocketå®ç°çš„ï¼Œæ‰€ä»¥å¯äº«å—åˆ°ä»…ä½¿ç”¨ Foundation æ¡†æ¶çš„ <code>Dispatch Source</code> å¸¦æ¥çš„å¥½å¤„ã€‚</p>
<p>é‚£ä¹ˆä¼˜åŠ¿ä½•åœ¨ï¼Ÿä½¿ç”¨çš„ <code>Dispatch Source</code> è€Œä¸ä½¿ç”¨ <code>dispatch_async</code> çš„å”¯ä¸€åŸå› å°±æ˜¯åˆ©ç”¨è”ç»“çš„ä¼˜åŠ¿ã€‚</p>
<p>è”ç»“çš„å¤§è‡´æµç¨‹ï¼šåœ¨ä»»ä¸€çº¿ç¨‹ä¸Šè°ƒç”¨å®ƒçš„çš„ä¸€ä¸ªå‡½æ•° <code>dispatch_source_merge_data</code>  åï¼Œä¼šæ‰§è¡Œ <code>Dispatch Source</code> äº‹å…ˆå®šä¹‰å¥½çš„å¥æŸ„ï¼ˆå¯ä»¥æŠŠå¥æŸ„ç®€å•ç†è§£ä¸ºä¸€ä¸ª block ï¼‰ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹å« <code>Custom event</code> ,ç”¨æˆ·äº‹ä»¶ã€‚æ˜¯ dispatch source æ”¯æŒå¤„ç†çš„ä¸€ç§äº‹ä»¶ã€‚</p>
<blockquote>
<p>ç®€å•åœ°è¯´ï¼Œè¿™ç§äº‹ä»¶æ˜¯ç”±ä½ è°ƒç”¨ <code>dispatch_source_merge_data</code> å‡½æ•°æ¥å‘è‡ªå·±å‘å‡ºçš„ä¿¡å·ã€‚</p>
</blockquote>
<p>ä¸‹é¢ä»‹ç»ä¸‹ä½¿ç”¨æ­¥éª¤ï¼š</p>
<h2 id="Dispatch-Source-çš„ä½¿ç”¨æ­¥éª¤"><a href="#Dispatch-Source-çš„ä½¿ç”¨æ­¥éª¤" class="headerlink" title="Dispatch Source çš„ä½¿ç”¨æ­¥éª¤"></a><code>Dispatch Source</code> çš„ä½¿ç”¨æ­¥éª¤</h2><h3 id="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªDispatch-Source"><a href="#ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªDispatch-Source" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªDispatch Source"></a>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ª<code>Dispatch Source</code></h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// è¯¦è§ Demo1ã€Demo2</div><div class="line">// æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div class="line">_processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div class="line">                                                dispatch_get_main_queue());</div></pre></td></tr></table></figure>
<p>ä¸‹é¢å¯¹å‚æ•°è¿›è¡Œä¸‹è§£é‡Šï¼š</p>
<p>å…¶ä¸­è‡ªå®šä¹‰æºç´¯ç§¯äº‹ä»¶ä¸­ä¼ é€’è¿‡æ¥çš„å€¼ï¼Œç´¯ç§¯çš„æ–¹å¼å¯ä»¥æ˜¯ç›¸åŠ çš„ï¼Œæ­£å¦‚ä¸Šé¢ä»£ç ä¸­çš„ <code>DISPATCH_SOURCE_TYPE_DATA_ADD</code> ï¼Œä¹Ÿå¯ä»¥æ˜¯é€»è¾‘æˆ– <code>DISPATCH_SOURCE_TYPE_DATA_OR</code> ã€‚è¿™æ˜¯æœ€å¸¸è§çš„ä¸¤ä¸ª <code>Dispatch Source</code> å¯ä»¥å¤„ç†çš„äº‹ä»¶ã€‚</p>
<p><code>Dispatch Source</code> å¯å¤„ç†çš„æ‰€æœ‰äº‹ä»¶ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>åç§°</th>
<th>å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_DATA_ADD</code></td>
<td>å˜é‡å¢åŠ </td>
</tr>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_DATA_OR</code></td>
<td>å˜é‡OR</td>
</tr>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_MACH_SEND</code></td>
<td>MACHç«¯å£å‘é€</td>
</tr>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_MACH_RECV</code></td>
<td>MACHç«¯å£æ¥æ”¶</td>
</tr>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_PROC</code></td>
<td>ç›‘æµ‹åˆ°ä¸è¿›ç¨‹ç›¸å…³çš„äº‹ä»¶</td>
</tr>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_READ</code></td>
<td>å¯è¯»å–æ–‡ä»¶æ˜ åƒ</td>
</tr>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_SIGNAL</code></td>
<td>æ¥æ”¶ä¿¡å·</td>
</tr>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_TIMER</code></td>
<td>å®šæ—¶å™¨</td>
</tr>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_VNODE</code></td>
<td>æ–‡ä»¶ç³»ç»Ÿæœ‰å˜æ›´</td>
</tr>
<tr>
<td> <code>DISPATCH_SOURCE_TYPE_WRITE</code></td>
<td>å¯å†™å…¥æ–‡ä»¶æ˜ åƒ</td>
</tr>
</tbody>
</table>
<p>è‡ªå®šä¹‰æºä¹Ÿéœ€è¦ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨æ¥å¤„ç†æ‰€æœ‰çš„å“åº”å¥æŸ„ï¼ˆblockï¼‰ã€‚é‚£ä¹ˆå²‚ä¸æ˜¯æœ‰ä¸¤ä¸ªé˜Ÿåˆ—äº†ï¼Ÿæ²¡é”™ï¼Œè‡³äº <code>Dispatch Queue</code> è¿™ä¸ªé˜Ÿåˆ—çš„çº¿ç¨‹æ‰§è¡Œä¸  <code>Dispatch Source</code>è¿™ä¸ªé˜Ÿåˆ—çš„çº¿ç¨‹æ‰§è¡Œçš„å…³ç³»ï¼Œä¸‹æ–‡ä¼šç»“åˆ Demo1å’Œ Demo2è¿›è¡Œè¯¦ç»†è®ºè¿°ã€‚</p>
<h3 id="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºDispatch-Sourceçš„äº‹ä»¶å¤„ç†æ–¹æ³•"><a href="#ç¬¬äºŒæ­¥ï¼šåˆ›å»ºDispatch-Sourceçš„äº‹ä»¶å¤„ç†æ–¹æ³•" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºDispatch Sourceçš„äº‹ä»¶å¤„ç†æ–¹æ³•"></a>ç¬¬äºŒæ­¥ï¼šåˆ›å»º<code>Dispatch Source</code>çš„äº‹ä»¶å¤„ç†æ–¹æ³•</h3><p>åˆ†æ´¾æºæä¾›äº†é«˜æ•ˆçš„æ–¹å¼æ¥å¤„ç†äº‹ä»¶ã€‚é¦–å…ˆæ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œäº‹ä»¶å‘ç”Ÿæ—¶ä¼šæ”¶åˆ°é€šçŸ¥ã€‚å¦‚æœåœ¨ç³»ç»Ÿè¿˜æ²¡æœ‰æ¥å¾—åŠé€šçŸ¥ä½ ä¹‹å‰äº‹ä»¶å°±å‘ç”Ÿäº†å¤šæ¬¡ï¼Œé‚£ä¹ˆè¿™äº›äº‹ä»¶ä¼šè¢«åˆå¹¶ä¸ºä¸€ä¸ªäº‹ä»¶ã€‚è¿™å¯¹äºåº•å±‚çš„é«˜æ€§èƒ½ä»£ç å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯OSåº”ç”¨å¼€å‘è€…å¾ˆå°‘ä¼šç”¨åˆ°è¿™æ ·çš„åŠŸèƒ½ã€‚ç±»ä¼¼åœ°ï¼Œåˆ†æ´¾æºå¯ä»¥å“åº”UNIXä¿¡å·ã€æ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ã€å…¶ä»–è¿›ç¨‹çš„å˜åŒ–ä»¥åŠMach Portäº‹ä»¶ã€‚å®ƒä»¬ä¸­å¾ˆå¤šéƒ½åœ¨Macç³»ç»Ÿä¸Šå¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯iOSå¼€å‘è€…é€šå¸¸ä¸ä¼šç”¨åˆ°ã€‚</p>
<p>ä¸è¿‡ï¼Œè‡ªå®šä¹‰æºåœ¨iOSä¸­å¾ˆæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨æ€§èƒ½è‡³å…³é‡è¦çš„åœºåˆè¿›è¡Œè¿›åº¦åé¦ˆã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæº:è‡ªå®šä¹‰æºç´¯ç§¯äº‹ä»¶ä¸­ä¼ é€’è¿‡æ¥çš„å€¼ã€‚ç´¯ç§¯æ–¹å¼å¯ä»¥æ˜¯ç›¸åŠ ( DISPATCH_SOURCE_TYPE_DATA_ADD ),<br>ä¹Ÿå¯ä»¥æ˜¯é€»è¾‘æˆ–( DISPATCH_SOURCE_DATA_OR )ã€‚è‡ªå®šä¹‰æºä¹Ÿéœ€è¦ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨æ¥å¤„ç†æ‰€æœ‰çš„å“åº”å¤„ç†å—ã€‚</p>
<p>åˆ›å»ºæºåï¼Œéœ€è¦æä¾›ç›¸åº”çš„å¤„ç†æ–¹æ³•ã€‚å½“æºç”Ÿæ•ˆæ—¶ä¼šåˆ†æ´¾æ³¨å†Œå¤„ç†æ–¹æ³•;å½“äº‹ä»¶å‘ç”Ÿæ—¶ä¼šåˆ†æ´¾äº‹ä»¶å¤„ç†æ–¹æ³•;å½“æºè¢«å–æ¶ˆæ—¶ä¼šåˆ†æ´¾å–æ¶ˆå¤„ç†æ–¹æ³•ã€‚è‡ªå®šä¹‰æºé€šå¸¸åªéœ€è¦ä¸€ä¸ªäº‹ä»¶å¤„ç†æ–¹æ³•ï¼Œå¯ä»¥åƒè¿™æ ·åˆ›å»º:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/*</div><div class="line"> *çœç•¥éƒ¨åˆ†ï¼š </div><div class="line">   æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div class="line">   è¯¦è§Demo1ã€Demo2</div><div class="line"> *</div><div class="line"> */</div><div class="line">   __block NSUInteger totalComplete = 0;</div><div class="line">   dispatch_source_set_event_handler(_processingQueueSource, ^&#123;</div><div class="line">       //å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡dispatch_source_get_dataæ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥totalCompleteçš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</div><div class="line">       NSUInteger value = dispatch_source_get_data(_processingQueueSource);</div><div class="line">       totalComplete += value;</div><div class="line">       NSLog(@&quot;è¿›åº¦ï¼š%@&quot;, @((CGFloat)totalComplete/100));</div><div class="line">   &#125;);</div></pre></td></tr></table></figure>
<p>åœ¨åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€ä¸ªå¤„ç†æ–¹æ³•å—çš„å®ä¾‹è¢«åˆ†æ´¾ã€‚å¦‚æœè¿™ä¸ªå¤„ç†æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œå¦ä¸€ä¸ªäº‹ä»¶å°±å‘ç”Ÿäº†ï¼Œäº‹ä»¶ä¼šä»¥æŒ‡å®šæ–¹å¼(ADDæˆ–è€…OR)è¿›è¡Œç´¯ç§¯ã€‚é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ï¼Œç³»ç»Ÿå³ä½¿åœ¨é«˜è´Ÿ<br>è½½æƒ…å†µä¸‹ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚å½“å¤„ç†äº‹ä»¶ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡ <code>dispatch_source_get_data</code> æ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥ä¸Šé¢ä¾‹å­ä¸­ <code>totalComplete</code> çš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</p>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šå¤„ç†Dispatch-Sourceçš„æš‚åœä¸æ¢å¤æ“ä½œ"><a href="#ç¬¬ä¸‰æ­¥ï¼šå¤„ç†Dispatch-Sourceçš„æš‚åœä¸æ¢å¤æ“ä½œ" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå¤„ç†Dispatch Sourceçš„æš‚åœä¸æ¢å¤æ“ä½œ"></a>ç¬¬ä¸‰æ­¥ï¼šå¤„ç†<code>Dispatch Source</code>çš„æš‚åœä¸æ¢å¤æ“ä½œ</h3><p>å½“è¿½åŠ å¤§é‡å¤„ç†åˆ°Dispatch Queueæ—¶ï¼Œåœ¨è¿½åŠ å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å¸Œæœ›ä¸æ‰§è¡Œå·²è¿½åŠ çš„å¤„ç†ã€‚ä¾‹å¦‚æ¼”ç®—ç»“æœè¢«Blockæˆªè·æ—¶ï¼Œä¸€äº›å¤„ç†ä¼šå¯¹è¿™ä¸ªæ¼”ç®—ç»“æœé€ æˆå½±å“ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªè¦æŒ‚èµ·Dispatch Queueå³å¯ã€‚å½“å¯ä»¥æ‰§è¡Œæ—¶å†æ¢å¤ã€‚</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dispatch_suspend(queue);</div></pre></td></tr></table></figure>
<p> <code>dispatch_resume</code> å‡½æ•°æ¢å¤æŒ‡å®šçš„ <code>Dispatch Queue</code> .<br>è¿™äº›å‡½æ•°å¯¹å·²ç»æ‰§è¡Œçš„å¤„ç†æ²¡æœ‰å½±å“ã€‚æŒ‚èµ·åï¼Œè¿½åŠ åˆ° <code>Dispatch Queue</code> ä¸­ä½†å°šæœªæ‰§è¡Œçš„å¤„ç†åœ¨æ­¤ä¹‹ååœæ­¢æ‰§è¡Œã€‚è€Œæ¢å¤åˆ™ä½¿å¾—è¿™äº›å¤„ç†èƒ½å¤Ÿç»§ç»­æ‰§è¡Œã€‚</p>
<p>åˆ†æ´¾æºåˆ›å»ºæ—¶é»˜è®¤å¤„äºæš‚åœçŠ¶æ€ï¼Œåœ¨åˆ†æ´¾æºåˆ†æ´¾å¤„ç†ç¨‹åºä¹‹å‰å¿…é¡»å…ˆæ¢å¤ã€‚å› ä¸ºå¿˜è®°æ¢å¤åˆ†æ´¾æºçš„çŠ¶æ€è€Œäº§ç”Ÿbugæ˜¯å¸¸è§çš„äº‹å„¿ã€‚æ¢å¤çš„æ–¹æ³•æ˜¯è°ƒç”¨ <code>dispatch_resume</code> :</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dispatch_resume (source);</div></pre></td></tr></table></figure>
<p>ä¸ºäº†æ–¹ä¾¿ç†è§£ <code>dispatch_suspend</code> å‡½æ•°çš„ä½œç”¨ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ª Demoï¼šDemo3ï¼Œ çœ‹ä¸‹è¿è¡Œæ•ˆæœï¼š</p>
<p>æ€è€ƒä¸‹NSLogçš„æ‰“å°é¡ºåºä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·ï¼Ÿ</p>
<p>è¯¦è§ Demo3ï¼ˆDemo<em>03</em>å¯¹DispatchQueueå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_ç®€å•ç‰ˆï¼‰ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    dispatch_queue_t queue1 = dispatch_queue_create(&quot;com.iOSChengXuYuan.queue1&quot;, 0);</div><div class="line">    dispatch_queue_t queue2 = dispatch_queue_create(&quot;com.iOSChengXuYuan.queue2&quot;, 0);</div><div class="line">    dispatch_group_t group = dispatch_group_create();</div><div class="line">    </div><div class="line">    dispatch_async(queue1, ^&#123;</div><div class="line">        NSLog(@&quot;ä»»åŠ¡ 1 ï¼š queue 1...&quot;);</div><div class="line">        sleep(1);</div><div class="line">        NSLog(@&quot;âœ…å®Œæˆä»»åŠ¡ 1&quot;);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_async(queue2, ^&#123;</div><div class="line">        NSLog(@&quot;ä»»åŠ¡ 1 ï¼š queue 2...&quot;);</div><div class="line">        sleep(1);</div><div class="line">        NSLog(@&quot;âœ…å®Œæˆä»»åŠ¡ 2&quot;);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_group_async(group, queue1, ^&#123;</div><div class="line">        NSLog(@&quot;ğŸš«æ­£åœ¨æš‚åœ 1&quot;);</div><div class="line">        dispatch_suspend(queue1);</div><div class="line">    &#125;);</div><div class="line">    dispatch_group_async(group, queue2, ^&#123;</div><div class="line">        NSLog(@&quot;ğŸš«æ­£åœ¨æš‚åœ 2&quot;);</div><div class="line">        dispatch_suspend(queue2);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</div><div class="line">    NSLog(@&quot;ï¼ï¼ï¼ï¼ï¼ï¼ï¼ç­‰å¾…ä¸¤ä¸ªqueueå®Œæˆ, å†å¾€ä¸‹è¿›è¡Œ...&quot;);</div><div class="line">    dispatch_async(queue1, ^&#123;</div><div class="line">        NSLog(@&quot;ä»»åŠ¡ 2 ï¼š queue 1&quot;);</div><div class="line">    &#125;);</div><div class="line">    dispatch_async(queue2, ^&#123;</div><div class="line">        NSLog(@&quot;ä»»åŠ¡ 2 ï¼š queue 2&quot;);</div><div class="line">    &#125;);</div><div class="line">    NSLog(@&quot;ğŸ”´ä¸ºä»€ä¹ˆè¿™ä¸ªNSLogä¼šåœ¨ä¸Šé¢ä¸¤ä¸ªNSLogä¹‹å‰æ‰“å°â“â“ç­”ï¼šdispatch_suspendçš„ä½œç”¨â€¼ï¸&quot;);</div><div class="line">    </div><div class="line">    dispatch_resume(queue1);</div><div class="line">    dispatch_resume(queue2);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">2015-09-06 02:44:59.614 CYLDispatchQueueSuspendTest[1610:116662] ä»»åŠ¡ 1 ï¼š queue 2...</div><div class="line">2015-09-06 02:44:59.613 CYLDispatchQueueSuspendTest[1610:116665] ä»»åŠ¡ 1 ï¼š queue 1...</div><div class="line">2015-09-06 02:45:00.614 CYLDispatchQueueSuspendTest[1610:116665] âœ…å®Œæˆä»»åŠ¡ 1</div><div class="line">2015-09-06 02:45:00.614 CYLDispatchQueueSuspendTest[1610:116662] âœ…å®Œæˆä»»åŠ¡ 2</div><div class="line">2015-09-06 02:45:00.616 CYLDispatchQueueSuspendTest[1610:116662] ğŸš«æ­£åœ¨æš‚åœ 2</div><div class="line">2015-09-06 02:45:00.615 CYLDispatchQueueSuspendTest[1610:116665] ğŸš«æ­£åœ¨æš‚åœ 1</div><div class="line">2015-09-06 02:45:00.616 CYLDispatchQueueSuspendTest[1610:116515] ï¼ï¼ï¼ï¼ï¼ï¼ï¼ç­‰å¾…ä¸¤ä¸ªqueueå®Œæˆ, å†å¾€ä¸‹è¿›è¡Œ...</div><div class="line">2015-09-06 02:45:00.616 CYLDispatchQueueSuspendTest[1610:116515] ğŸ”´ä¸ºä»€ä¹ˆè¿™ä¸ªNSLogä¼šåœ¨ä¸Šé¢ä¸¤ä¸ªNSLogä¹‹å‰æ‰“å°â“â“ç­”ï¼šdispatch_suspendçš„ä½œç”¨â€¼ï¸</div><div class="line">2015-09-06 02:45:00.617 CYLDispatchQueueSuspendTest[1610:116665] ä»»åŠ¡ 2 ï¼š queue 1</div><div class="line">2015-09-06 02:45:00.619 CYLDispatchQueueSuspendTest[1610:116665] ä»»åŠ¡ 2 ï¼š queue 2</div></pre></td></tr></table></figure>
<p>æ€è€ƒä¸‹NSLogçš„æ‰“å°é¡ºåºä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·ï¼Ÿç­”ï¼šdispatch_suspendçš„ä½œç”¨ï¼</p>
<p>è¯¦è§ Demo3ï¼ˆDemo<em>03</em>å¯¹DispatchQueueå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_ç®€å•ç‰ˆï¼‰ã€‚</p>
<h3 id="ç¬¬å››æ­¥ï¼šå‘Dispatch-Sourceå‘é€äº‹ä»¶"><a href="#ç¬¬å››æ­¥ï¼šå‘Dispatch-Sourceå‘é€äº‹ä»¶" class="headerlink" title="ç¬¬å››æ­¥ï¼šå‘Dispatch Sourceå‘é€äº‹ä»¶"></a>ç¬¬å››æ­¥ï¼šå‘<code>Dispatch Source</code>å‘é€äº‹ä»¶</h3><p>æ¢å¤æºåï¼Œå°±å¯ä»¥åƒä¸‹é¢çš„ä»£ç ç‰‡æ®µè¿™æ ·ï¼Œé€šè¿‡ <code>dispatch_source_merge_data</code> å‘åˆ†æ´¾æºå‘é€äº‹ä»¶:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//2.</div><div class="line">//æ¢å¤æºåï¼Œå°±å¯ä»¥é€šè¿‡dispatch_source_merge_dataå‘Dispatch Source(åˆ†æ´¾æº)å‘é€äº‹ä»¶:</div><div class="line">//è¯¦è§Demo1ã€Demo2</div><div class="line">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    for (NSUInteger index = 0; index &lt; 100; index++) &#123;</div><div class="line">        dispatch_async(queue, ^&#123;</div><div class="line">        dispatch_source_merge_data(_processingQueueSource, 1);</div><div class="line">        usleep(20000);//0.02ç§’</div><div class="line">        &#125;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç åœ¨æ¯æ¬¡å¾ªç¯ä¸­æ‰§è¡ŒåŠ 1æ“ä½œã€‚ä¹Ÿå¯ä»¥ä¼ é€’å·²å¤„ç†è®°å½•çš„æ•°ç›®æˆ–å·²å†™å…¥çš„å­—èŠ‚æ•°ã€‚åœ¨ä»»ä½•çº¿ç¨‹ä¸­éƒ½å¯ä»¥è°ƒç”¨  <code>dispatch_source_merge_data</code> ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸å¯ä»¥ä¼ é€’0å€¼(äº‹ä»¶ä¸ä¼šè¢«è§¦å‘)ï¼ŒåŒæ ·ä¹Ÿä¸å¯ä»¥ä¼ é€’è´Ÿæ•°ã€‚</p>
<h1 id="GCDçœŸçš„ä¸èƒ½åƒOperationQueueé‚£æ ·ç»ˆæ­¢ä»»åŠ¡ï¼Ÿ"><a href="#GCDçœŸçš„ä¸èƒ½åƒOperationQueueé‚£æ ·ç»ˆæ­¢ä»»åŠ¡ï¼Ÿ" class="headerlink" title="GCDçœŸçš„ä¸èƒ½åƒOperationQueueé‚£æ ·ç»ˆæ­¢ä»»åŠ¡ï¼Ÿ"></a>GCDçœŸçš„ä¸èƒ½åƒOperationQueueé‚£æ ·ç»ˆæ­¢ä»»åŠ¡ï¼Ÿ</h1><h3 id="å®Œæ•´ä¾‹å­Demo1ï¼šè®©-Dispatch-Source-â€œå¸®â€-Dispatch-Queue-å®ç°æš‚åœå’Œæ¢å¤åŠŸèƒ½"><a href="#å®Œæ•´ä¾‹å­Demo1ï¼šè®©-Dispatch-Source-â€œå¸®â€-Dispatch-Queue-å®ç°æš‚åœå’Œæ¢å¤åŠŸèƒ½" class="headerlink" title="å®Œæ•´ä¾‹å­Demo1ï¼šè®© Dispatch Source â€œå¸®â€ Dispatch Queue å®ç°æš‚åœå’Œæ¢å¤åŠŸèƒ½"></a>å®Œæ•´ä¾‹å­Demo1ï¼šè®© Dispatch Source â€œå¸®â€ Dispatch Queue å®ç°æš‚åœå’Œæ¢å¤åŠŸèƒ½</h3><p>æœ¬èŠ‚é…å¥—ä»£ç åœ¨ <code>Demo1</code> ä¸­ï¼ˆDemo<em>01</em>å¯¹DispatchSourceå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_mainé˜Ÿåˆ—ç‰ˆï¼‰ã€‚</p>
<p>å…ˆå†™ä¸€æ®µä»£ç æ¼”ç¤ºä¸‹DispatchSourceçš„åŸºæœ¬ç”¨æ³•ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">//</div><div class="line">//  .m</div><div class="line">//  CYLDispatchSourceTest</div><div class="line">//</div><div class="line">//  Created by å¾®åš@iOSç¨‹åºçŠ­è¢ï¼ˆ http://weibo.com/luohanchenyilong/ï¼‰ on 15/9/1.</div><div class="line">//  Copyright (c) 2015å¹´ https://github.com/ChenYilong . All rights reserved.</div><div class="line">//</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    //1.</div><div class="line">    // æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div class="line">    _processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div class="line">                                                    dispatch_get_main_queue());</div><div class="line">    __block NSUInteger totalComplete = 0;</div><div class="line">    dispatch_source_set_event_handler(_processingQueueSource, ^&#123;</div><div class="line">        //å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡dispatch_source_get_dataæ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥totalCompleteçš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</div><div class="line">        NSUInteger value = dispatch_source_get_data(_processingQueueSource);</div><div class="line">        totalComplete += value;</div><div class="line">        NSLog(@&quot;è¿›åº¦ï¼š%@&quot;, @((CGFloat)totalComplete/100));</div><div class="line">        NSLog(@&quot;ğŸ”µçº¿ç¨‹å·ï¼š%@&quot;, [NSThread currentThread]);</div><div class="line">    &#125;);</div><div class="line">    //åˆ†æ´¾æºåˆ›å»ºæ—¶é»˜è®¤å¤„äºæš‚åœçŠ¶æ€ï¼Œåœ¨åˆ†æ´¾æºåˆ†æ´¾å¤„ç†ç¨‹åºä¹‹å‰å¿…é¡»å…ˆæ¢å¤ã€‚</div><div class="line">    [self resume];</div><div class="line">    </div><div class="line">    //2.</div><div class="line">    //æ¢å¤æºåï¼Œå°±å¯ä»¥é€šè¿‡dispatch_source_merge_dataå‘Dispatch Source(åˆ†æ´¾æº)å‘é€äº‹ä»¶:</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        for (NSUInteger index = 0; index &lt; 100; index++) &#123;</div><div class="line">            dispatch_source_merge_data(_processingQueueSource, 1);</div><div class="line">            NSLog(@&quot;â™»ï¸çº¿ç¨‹å·ï¼š%@&quot;, [NSThread currentThread]);</div><div class="line">            usleep(20000);//0.02ç§’</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆ™è¾“å‡ºæ—¥å¿—ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">2015-09-03 16:50:48.346 CYLDispatchSourceTest[8331:874681] âœ…æ¢å¤Dispatch Source(åˆ†æ´¾æº)</div><div class="line">2015-09-03 16:50:48.348 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:48.372 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:48.401 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:48.424 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:48.444 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:48.473 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:48.493 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:48.515 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.07000000000000001</div><div class="line">2015-09-03 16:50:48.515 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:50:48.516 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.08</div><div class="line">2015-09-03 16:50:48.516 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:48.535 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:50:48.556 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.09</div><div class="line">/*================çœç•¥ä¸­é—´====================*/</div><div class="line">2015-09-03 16:50:50.630 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:50:50.630 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:50.654 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.97</div><div class="line">2015-09-03 16:50:50.654 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:50:50.654 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:50.676 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.98</div><div class="line">2015-09-03 16:50:50.676 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:50:50.676 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:50.699 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:50:50.708 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.99</div><div class="line">2015-09-03 16:50:50.708 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:50:50.722 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š1</div><div class="line">2015-09-03 16:50:50.722 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:50:50.722 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;&#123;number = 2, name = (null)&#125;</div></pre></td></tr></table></figure>
<p>è€—æ—¶ï¼š2.376</p>
<p>è¿™æ®µä»£ç è¿˜å¯ä»¥è¿›è¡Œå¦‚ä¸‹ä¼˜åŒ–ï¼š</p>
<p>å°†åˆ›å»ºå¼‚æ­¥çš„æ“ä½œæ”¾åœ¨ for å¾ªç¯å†…éƒ¨ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    //1.</div><div class="line">    // æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div class="line">    _processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div class="line">                                                      dispatch_get_main_queue());</div><div class="line">    __block NSUInteger totalComplete = 0;</div><div class="line">    dispatch_source_set_event_handler(_processingQueueSource, ^&#123;</div><div class="line">        //å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡dispatch_source_get_dataæ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥totalCompleteçš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</div><div class="line">        NSUInteger value = dispatch_source_get_data(_processingQueueSource);</div><div class="line">        totalComplete += value;</div><div class="line">        NSLog(@&quot;è¿›åº¦ï¼š%@&quot;, @((CGFloat)totalComplete/100));</div><div class="line">        NSLog(@&quot;ğŸ”µçº¿ç¨‹å·ï¼š%@&quot;, [NSThread currentThread]);</div><div class="line"></div><div class="line">    &#125;);</div><div class="line">    //åˆ†æ´¾æºåˆ›å»ºæ—¶é»˜è®¤å¤„äºæš‚åœçŠ¶æ€ï¼Œåœ¨åˆ†æ´¾æºåˆ†æ´¾å¤„ç†ç¨‹åºä¹‹å‰å¿…é¡»å…ˆæ¢å¤ã€‚</div><div class="line">    [self resume];</div><div class="line">    </div><div class="line">    //2.</div><div class="line">    //æ¢å¤æºåï¼Œå°±å¯ä»¥é€šè¿‡dispatch_source_merge_dataå‘Dispatch Source(åˆ†æ´¾æº)å‘é€äº‹ä»¶:</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">        for (NSUInteger index = 0; index &lt; 100; index++) &#123;</div><div class="line">            dispatch_async(queue, ^&#123;</div><div class="line">            dispatch_source_merge_data(_processingQueueSource, 1);</div><div class="line">            NSLog(@&quot;â™»ï¸çº¿ç¨‹å·ï¼š%@&quot;, [NSThread currentThread]);</div><div class="line">            usleep(20000);//0.02ç§’</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">2015-09-03 16:48:10.153 CYLDispatchSourceTest[8301:871133] âœ…æ¢å¤Dispatch Source(åˆ†æ´¾æº)</div><div class="line">2015-09-03 16:48:10.154 CYLDispatchSourceTest[8301:871174] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663616c50&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.156 CYLDispatchSourceTest[8301:871177] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663417370&gt;&#123;number = 4, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.156 CYLDispatchSourceTest[8301:871176] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66359ac80&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.163 CYLDispatchSourceTest[8301:871184] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635507b0&gt;&#123;number = 5, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.164 CYLDispatchSourceTest[8301:871185] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663618c90&gt;&#123;number = 6, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.164 CYLDispatchSourceTest[8301:871186] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663596920&gt;&#123;number = 7, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.174 CYLDispatchSourceTest[8301:871187] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663465d20&gt;&#123;number = 8, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.174 CYLDispatchSourceTest[8301:871175] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634404f0&gt;&#123;number = 9, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.182 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.09</div><div class="line">2015-09-03 16:48:10.174 CYLDispatchSourceTest[8301:871174] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663616c50&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.187 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.184 CYLDispatchSourceTest[8301:871188] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66348e850&gt;&#123;number = 10, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.184 CYLDispatchSourceTest[8301:871177] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663417370&gt;&#123;number = 4, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.191 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.13</div><div class="line">2015-09-03 16:48:10.187 CYLDispatchSourceTest[8301:871192] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66348db80&gt;&#123;number = 11, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.191 CYLDispatchSourceTest[8301:871189] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635121b0&gt;&#123;number = 12, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.191 CYLDispatchSourceTest[8301:871176] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66359ac80&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.196 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.192 CYLDispatchSourceTest[8301:871184] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635507b0&gt;&#123;number = 5, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.192 CYLDispatchSourceTest[8301:871185] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663618c90&gt;&#123;number = 6, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.192 CYLDispatchSourceTest[8301:871186] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663596920&gt;&#123;number = 7, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.194 CYLDispatchSourceTest[8301:871190] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635138b0&gt;&#123;number = 13, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.196 CYLDispatchSourceTest[8301:871187] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663465d20&gt;&#123;number = 8, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.196 CYLDispatchSourceTest[8301:871175] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634404f0&gt;&#123;number = 9, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.206 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.21</div><div class="line">2015-09-03 16:48:10.207 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.210 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.23</div><div class="line">2015-09-03 16:48:10.201 CYLDispatchSourceTest[8301:871193] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663487830&gt;&#123;number = 14, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.207 CYLDispatchSourceTest[8301:871194] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634662c0&gt;&#123;number = 15, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.207 CYLDispatchSourceTest[8301:871195] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663618160&gt;&#123;number = 16, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.211 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.210 CYLDispatchSourceTest[8301:871196] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663566720&gt;&#123;number = 17, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.211 CYLDispatchSourceTest[8301:871174] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663616c50&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">/*ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼çœç•¥20è¡Œå¸¦æœ‰çš„ â™»ï¸çš„æ‰“å°å†…å®¹ï¼ˆæ²¡æœ‰é‡å¤çš„çº¿ç¨‹å·ï¼‰ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼*/</div><div class="line">2015-09-03 16:48:10.239 CYLDispatchSourceTest[8301:871196] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663566720&gt;&#123;number = 17, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.239 CYLDispatchSourceTest[8301:871174] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663616c50&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.239 CYLDispatchSourceTest[8301:871191] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663597ca0&gt;&#123;number = 18, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.245 CYLDispatchSourceTest[8301:871202] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663617c00&gt;&#123;number = 24, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.247 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.249 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.5</div><div class="line">2015-09-03 16:48:10.249 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.248 CYLDispatchSourceTest[8301:871203] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663531ab0&gt;&#123;number = 25, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.249 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.51</div><div class="line">2015-09-03 16:48:10.249 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.250 CYLDispatchSourceTest[8301:871204] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66344bbf0&gt;&#123;number = 26, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.250 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.52</div><div class="line">2015-09-03 16:48:10.251 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.251 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.53</div><div class="line">2015-09-03 16:48:10.250 CYLDispatchSourceTest[8301:871205] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663461d90&gt;&#123;number = 27, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.251 CYLDispatchSourceTest[8301:871206] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66341d370&gt;&#123;number = 28, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.252 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.252 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.54</div><div class="line">2015-09-03 16:48:10.251 CYLDispatchSourceTest[8301:871207] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634196e0&gt;&#123;number = 29, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.253 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.254 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.57</div><div class="line">2015-09-03 16:48:10.254 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.255 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.58</div><div class="line">2015-09-03 16:48:10.252 CYLDispatchSourceTest[8301:871208] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66341bd50&gt;&#123;number = 30, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.253 CYLDispatchSourceTest[8301:871209] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66361a070&gt;&#123;number = 31, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.253 CYLDispatchSourceTest[8301:871210] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663618020&gt;&#123;number = 32, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.255 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.255 CYLDispatchSourceTest[8301:871211] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663612c90&gt;&#123;number = 33, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.256 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.59</div><div class="line">2015-09-03 16:48:10.257 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.256 CYLDispatchSourceTest[8301:871212] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635996d0&gt;&#123;number = 34, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.259 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.6</div><div class="line">2015-09-03 16:48:10.259 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.259 CYLDispatchSourceTest[8301:871213] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66340bd30&gt;&#123;number = 35, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.260 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.61</div><div class="line">2015-09-03 16:48:10.264 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.262 CYLDispatchSourceTest[8301:871214] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66354f4b0&gt;&#123;number = 36, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.264 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.62</div><div class="line">2015-09-03 16:48:10.264 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.264 CYLDispatchSourceTest[8301:871215] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663531010&gt;&#123;number = 37, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.63</div><div class="line">2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871216] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66360c6e0&gt;&#123;number = 38, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871176] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66359ac80&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.64</div><div class="line">2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871198] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663576ab0&gt;&#123;number = 20, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871189] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635121b0&gt;&#123;number = 12, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871188] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66348e850&gt;&#123;number = 10, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871192] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66348db80&gt;&#123;number = 11, name = (null)&#125;</div><div class="line">/*ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼çœç•¥30è¡Œå¸¦æœ‰çš„ â™»ï¸çš„æ‰“å°å†…å®¹ï¼ˆæ²¡æœ‰é‡å¤çš„çº¿ç¨‹å·ï¼‰ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼*/</div><div class="line">2015-09-03 16:48:10.277 CYLDispatchSourceTest[8301:871222] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66361ca00&gt;&#123;number = 43, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.278 CYLDispatchSourceTest[8301:871223] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66360c620&gt;&#123;number = 44, name = (null)&#125;</div><div class="line">2015-09-03 16:48:10.290 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div><div class="line">2015-09-03 16:48:10.293 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š1</div><div class="line">2015-09-03 16:48:10.293 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;&#123;number = 1, name = main&#125;</div></pre></td></tr></table></figure>
<p>è€—æ—¶ï¼š0.14ç§’ï¼Œä¸ä¹‹å‰çš„2.376ç§’ç›¸æ¯”ï¼Œæ—¶é—´æ˜¯åè€…çš„17å€ ï¼Œæ€§èƒ½ç›¸å·®å¾ˆå¤§ã€‚</p>
<h3 id="DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ"><a href="#DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ" class="headerlink" title="DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ"></a>DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ</h3><p>ç„¶è€Œä¸Šä¾‹ä¸­ä¹Ÿå› ä¸ºå¹¶å‘æ‰§è¡Œï¼Œé€Ÿåº¦ç›¸å½“å¿«ï¼Œè°ƒç”¨ <code>dispatch_source_merge_data</code> åæ‰€è§¦å‘çš„ <code>dispatch_source_set_event_handler</code> çš„é¢‘ç‡ä¹Ÿå¤§å¤§å‡å°‘ï¼Œæœ‰æ—¶åªä¼šåœ¨ç»“æŸæ—¶è§¦å‘ä¸€æ¬¡ã€‚</p>
<p>å¦‚æœä½ ç»†å¿ƒè§‚å¯Ÿä¸‹ä¸Šä¾‹ä¸­çš„æ‰“å°ğŸ”µï¼ˆå°è“ç‚¹ï¼‰â™»ï¸ï¼ˆå°ç»¿ç‚¹ï¼‰ä¸ªæ•°æ˜¯ä¸ä¸€çš„ï¼Œä½† <code>totalComplete</code> çš„å€¼ï¼Œæˆ–è€…è¿›åº¦æ¡ä»0.0åˆ°1.0çš„æ‰§è¡Œæ˜¯æ­£å¸¸ï¼Œä½†æ˜¯ğŸ”µï¼ˆå°è“ç‚¹ï¼‰ä¸ºä»€ä¹ˆæ²¡æœ‰è¢«æ‰“å°ï¼Ÿè¿™æ˜¯å› ä¸ºï¼š</p>
<blockquote>
<p>DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ</p>
</blockquote>
<p>åœ¨åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€ä¸ªå¤„ç† block çš„å®ä¾‹è¢«åˆ†é…ï¼Œå¦‚æœè¿™ä¸ªå¤„ç†æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œå¦ä¸€ä¸ªäº‹ä»¶å°±å‘ç”Ÿäº†ï¼Œäº‹ä»¶ä¼šä»¥æŒ‡å®šæ–¹å¼ï¼ˆADDæˆ– ORï¼‰è¿›è¡Œç´¯ç§¯ã€‚DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶ï¼ˆblockï¼‰çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œã€‚å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡ <code>dispatch_source_get_data</code> æ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”æ—¶é—´æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä¾‹å­ä¸­è¿›åº¦æ¡ <code>totalComplete</code> çš„å€¼æ˜¯æœ€ç»ˆç§¯ç´¯çš„å€¼ï¼Œè€Œ block ä¸æ˜¯æ¯æ¬¡éƒ½æ‰§è¡Œçš„ï¼Œä½†æ‰“å°ğŸ”µï¼ˆå°è“ç‚¹ï¼‰â™»ï¸ï¼ˆå°ç»¿ç‚¹ï¼‰ä¸ªæ•°ä¸ä¸€ã€‚ä½†èƒ½ç¡®ä¿è¿›åº¦æ¡èƒ½ä»0.0åˆ°1.0çš„æ­£å¸¸æ‰§è¡Œã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥æ¼”ç¤ºä¸‹å¦‚ä½•æ§åˆ¶Dispatch Source(åˆ†æ´¾æº)ï¼Œè®©å®ƒéšæ—¶æš‚åœï¼Œéšæ—¶æ¢å¤ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">- (void)didReceiveMemoryWarning &#123;</div><div class="line">    [super didReceiveMemoryWarning];</div><div class="line">    [self changeStatus:self.running];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)changeStatus:(BOOL)shouldPause &#123;</div><div class="line">    if (shouldPause) &#123;</div><div class="line">        [self pause];</div><div class="line">    &#125; else &#123;</div><div class="line">        [self resume];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)resume &#123;</div><div class="line">    if (self.running) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;âœ…æ¢å¤Dispatch Source(åˆ†æ´¾æº)&quot;);</div><div class="line">    self.running = YES;</div><div class="line">    dispatch_resume(_processingQueueSource);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)pause &#123;</div><div class="line">    if (!self.running) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;ğŸš«æš‚åœDispatch Source(åˆ†æ´¾æº)&quot;);</div><div class="line">    self.running = NO;</div><div class="line">    dispatch_suspend(_processingQueueSource);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¹¶å–æ¶ˆæ‰“å°çº¿ç¨‹çš„ <code>NSLog</code> ï¼Œç„¶åä½¿ç”¨ä¸‹å›¾ä¸­çš„å¿«æ·é”®è¿…é€Ÿè§¦å‘ <code>didReceiveMemoryWarning</code>  ä»¥åˆ‡æ¢Dispatch Source(åˆ†æ´¾æº)çš„çŠ¶æ€:</p>
<p><img src="http://i61.tinypic.com/6thjmf.jpg" alt="enter image description here"></p>
<p><img src="http://i59.tinypic.com/suyt0o.jpg" alt="enter image description here"></p>
<p>è¯¦è§ <code>Demo1</code> å®ç°ï¼ˆDemo<em>01</em>å¯¹DispatchSourceå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_mainé˜Ÿåˆ—ç‰ˆï¼‰ã€‚</p>
<h3 id="Dispatch-Source-ä¸-Dispatch-Queue-ä¸¤è€…åœ¨çº¿ç¨‹æ‰§è¡Œä¸Šçš„å…³ç³»"><a href="#Dispatch-Source-ä¸-Dispatch-Queue-ä¸¤è€…åœ¨çº¿ç¨‹æ‰§è¡Œä¸Šçš„å…³ç³»" class="headerlink" title="Dispatch Source ä¸ Dispatch Queue ä¸¤è€…åœ¨çº¿ç¨‹æ‰§è¡Œä¸Šçš„å…³ç³»"></a>Dispatch Source ä¸ Dispatch Queue ä¸¤è€…åœ¨çº¿ç¨‹æ‰§è¡Œä¸Šçš„å…³ç³»</h3><p>æœ¬èŠ‚é…å¥—ä»£ç åœ¨  <code>Demo2</code> ä¸­ï¼ˆDemo<em>02</em>å¯¹DispatchSourceå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_globalé˜Ÿåˆ—ç‰ˆï¼‰ã€‚</p>
<p>ç­”æ¡ˆæ˜¯ï¼šæ²¡æœ‰å…³ç³»ã€‚ä¸¤è€…ä¼šç‹¬ç«‹è¿è¡Œã€‚ Dispatch Queue åƒä¸€ä¸ªç”Ÿäº§ä»»åŠ¡çš„ç”Ÿäº§è€…ï¼Œè€Œ Dispatch Source åƒå¤„ç†ä»»åŠ¡çš„æ¶ˆè´¹è€…ã€‚å¯ä»¥ä¸€è¾¹å¼‚æ­¥ç”Ÿäº§ï¼Œä¹Ÿå¯ä¸€è¾¹å¼‚æ­¥æ¶ˆè´¹ã€‚ä½ å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹ä¸Šè°ƒç”¨ <code>dispatch_source_merge_data</code> ä»¥è§¦å‘ <code>dispatch_source_set_event_handler</code> ã€‚è€Œå¥æŸ„çš„æ‰§è¡Œçº¿ç¨‹ï¼Œå–å†³äºä½ åˆ›å»ºå¥æŸ„æ—¶æ‰€æŒ‡å®šçš„çº¿ç¨‹ï¼Œå¦‚æœä½ åƒä¸‹é¢è¿™æ ·åˆ›å»ºï¼Œé‚£ä¹ˆå¥æŸ„ä¼šåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„ Dispatch Queue</div><div class="line">_processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div class="line">                                                  dispatch_get_main_queue());</div></pre></td></tr></table></figure>
<p>å¦‚æœä½ åƒä¸‹é¢è¿™æ ·åˆ›å»ºï¼Œé‚£ä¹ˆå¥æŸ„ä¼šåœ¨å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®š global Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div class="line">_processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div class="line">                                                dispatch_get_global_queue(0, 0));</div></pre></td></tr></table></figure>
<p>è¯¦è§ <code>Demo2</code> å®ç°ï¼ˆDemo<em>02</em>å¯¹DispatchSourceå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_globalé˜Ÿåˆ—ç‰ˆï¼‰</p>
<h3 id="è®©-Dispatch-Source-ä¸-Dispatch-Queue-åŒæ—¶å®ç°æš‚åœå’Œæ¢å¤"><a href="#è®©-Dispatch-Source-ä¸-Dispatch-Queue-åŒæ—¶å®ç°æš‚åœå’Œæ¢å¤" class="headerlink" title="è®© Dispatch Source ä¸ Dispatch Queue åŒæ—¶å®ç°æš‚åœå’Œæ¢å¤"></a>è®© Dispatch Source ä¸ Dispatch Queue åŒæ—¶å®ç°æš‚åœå’Œæ¢å¤</h3><p>æœ¬èŠ‚ä»£ç è¯¦è§ Demo4ï¼ˆDemo<em>04</em>å¯¹DispatchQueueå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_ç»¼åˆç‰ˆï¼‰</p>
<p>ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼šä¸Šé¢çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼Œå®ƒåªæ˜¯ä¸€ç§â€œå‡æš‚åœâ€çš„çŠ¶æ€ã€‚for å¾ªç¯è¿˜æ˜¯è¦æ‰§è¡Œ100éï¼Œå¾ªç¯çš„æ¬¡æ•°å¹¶æ²¡æœ‰å› ä½ æš‚åœäº†æ´¾å‘æºè€Œæš‚åœï¼Œè¿™åœ¨å®é™…å¼€å‘ä¸­æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºçœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆæ°¸è¿œä¼šæ˜¯åœ¨è¿™é‡Œï¼Œè¿™æ ·çš„æš‚åœæ¯«æ— æ„ä¹‰ã€‚é‚£ä¹ˆå¦‚ä½•è®© for å¾ªç¯éšæ—¶å¯ä»¥æš‚åœï¼Ÿ</p>
<p>å®é™…ä¸Š <code>Dispatch Queue</code> æ²¡æœ‰â€œå–æ¶ˆâ€è¿™ä¸€æ¦‚å¿µã€‚ä¸€æ—¦å°†å¤„ç†è¿½åŠ åˆ° <code>Dispatch Queue</code> ä¸­ï¼Œå°±æ²¡æœ‰æ–¹æ³•å¯å°†è¯¥å¤„ç†å»é™¤ï¼Œä¹Ÿæ²¡æœ‰æ–¹æ³•å¯åœ¨æ‰§è¡Œä¸­å–æ¶ˆè¯¥å¤„ç†ã€‚ç¼–ç¨‹äººå‘˜è¦ä¹ˆåœ¨å¤„ç†ä¸­å¯¼å…¥å–æ¶ˆè¿™ä¸€æ¦‚å¿µã€‚</p>
<p>è¦ä¹ˆæ”¾å¼ƒå–æ¶ˆï¼Œæˆ–è€…ä½¿ç”¨ <code>NSOperationQueue</code> ç­‰å…¶ä»–æ–¹æ³•ã€‚</p>
<p> <code>Dispatch Source</code> ä¸ <code>Dispatch Queue</code> ä¸åŒï¼Œæ˜¯å¯ä»¥å–æ¶ˆçš„ã€‚è€Œä¸”å–æ¶ˆæ—¶å¿…é¡»æ‰§è¡Œçš„å¤„ç†å¯æŒ‡å®šä¸ºå›è°ƒç”¨çš„Blockå½¢å¼ã€‚</p>
<p> <code>Dispatch Source</code>  æ˜¯å¦‚ä½•æ‰§è¡Œå–æ¶ˆçš„ï¼Ÿæ‰“ä¸ªæ¯”æ–¹ï¼š</p>
<p> <code>Dispatch Queue</code> å°±å¥½åƒç“œå†œç§ç“œï¼Œåªè¦ç§äº†ç“œï¼Œå°±èµ°ä¸Šäº†ä¸€æ¡ä¸å½’è·¯ï¼šä¸ç®¡æœ‰æ²¡æœ‰äººä¹°ï¼Œä½ éƒ½å¿…é¡»è¦å¥½å¥½æ–½è‚¥ï¼Œå¥½å¥½æµ‡æ°´ã€‚æ²¡æœ‰æ”¾å¼ƒçš„ä½™åœ°ã€‚</p>
<p> <code>Dispatch Source</code> å°±å¥½åƒä¹°ç“œçš„äººï¼Œæ¯”å¦‚ä½ åœ¨ç“œå†œç§ç“œæ—¶ï¼Œå‘Šè¯‰ç“œå†œï¼Œâ€œä½ çš„ç“œç†Ÿä¸€ä¸ªæˆ‘ä¹°ä¸€ä¸ªâ€ï¼Œç­‰ç“œæˆç†Ÿäº†ï¼Œä½ å¼€å§‹ä¹°ï¼Œä¸æ–­å¾—ä¹°ï¼Œé™†ç»­ä¹°äº†100ä¸ªï¼Œçªç„¶ä½ æ„Ÿè§‰åƒå¤Ÿäº†ï¼Œä½ ä¸ä¹°äº†ï¼Œä½†æ˜¯ç“œè¿˜æ˜¯åœ¨ä¸æ–­å¾—æˆç†Ÿç€ï¼Œç„¶ååªèƒ½çƒ‚åœ¨åœ°é‡Œäº†ã€‚ç­‰ä½ çªç„¶åˆæƒ³ä¹°çš„æ—¶å€™ï¼Œåœ°é‡Œå·²ç»æœ‰1000ä¸ªç“œï¼Œä½ è¦ä¹°ï¼Œå¿…é¡»å…¨ä¹°ã€‚ã€‚ã€‚</p>
<p>å›åˆ°ä»£ç é‡Œï¼Œä¹Ÿå°±æ˜¯è¯´ <code>Dispatch Source</code> çš„æš‚åœï¼Œåªæ˜¯æš‚åœè°ƒç”¨ <code>dispatch_source_set_event_handler</code> ï¼Œ <code>Dispatch Queue</code> ä¸­çš„forå¾ªç¯å¹¶æ²¡æœ‰å› æ­¤æš‚åœï¼Œå®ƒè¿˜æ˜¯åœ¨ä¸€ç›´è¿è¡Œç€ï¼Œç­‰ä½ æ¢å¤ <code>Dispatch Source</code> çš„æ—¶å€™ï¼Œ <code>Dispatch Queue</code> å¯èƒ½å·²ç»è¿è¡Œç»“æŸã€‚ç„¶åä½ å°±ä¼šåƒä¸Šé¢çš„gifå›¾ä¸­é‚£æ ·ï¼Œä»â€œè¿›åº¦ï¼š0.9â€æš‚åœï¼Œæ¢å¤æ—¶ç›´æ¥è·³åˆ°â€œè¿›åº¦ï¼š1â€ï¼Œè·³è¿‡äº†ä¸­é—´çš„â€œè¿›åº¦ï¼š0.91â€ã€â€œè¿›åº¦ï¼š0.92â€ã€â€œè¿›åº¦ï¼š0.93â€ç­‰ç­‰ã€‚æ‰€ä»¥è¯´è¿™æ˜¯ä¸€ç§â€œå‡æš‚åœâ€ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•åœ¨å¤„ç†ä¸­å¯¼å…¥å–æ¶ˆè¿™ä¸€æ¦‚å¿µï¼Ÿä»£ç å¦‚ä¸‹ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">__block BOOL isCanceled = NO;</div><div class="line">dispatch_async(queue, ^&#123;</div><div class="line"></div><div class="line">    if (isCanceled) &#123;</div><div class="line">        return;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">    NSData *thumbnailData = [NSURLConnection sendSynchronousRequest:request];</div><div class="line">    ...</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>å®Œæ•´çš„ä»£ç åˆ™éœ€è¦åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    //1.</div><div class="line">    // æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div class="line">    _processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div class="line">                                                    dispatch_get_main_queue());</div><div class="line">    __block NSUInteger totalComplete = 0;</div><div class="line">    dispatch_source_set_event_handler(_processingQueueSource, ^&#123;</div><div class="line">        //å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡dispatch_source_get_dataæ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥totalCompleteçš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</div><div class="line">        NSUInteger value = dispatch_source_get_data(_processingQueueSource);</div><div class="line">        totalComplete += value;</div><div class="line">        NSLog(@&quot;è¿›åº¦ï¼š%@&quot;, @((CGFloat)totalComplete/CYLTotalNumber));</div><div class="line">    &#125;);</div><div class="line">    //åˆ†æ´¾æºåˆ›å»ºæ—¶é»˜è®¤å¤„äºæš‚åœçŠ¶æ€ï¼Œåœ¨åˆ†æ´¾æºåˆ†æ´¾å¤„ç†ç¨‹åºä¹‹å‰å¿…é¡»å…ˆæ¢å¤ã€‚</div><div class="line">    [self resume];</div><div class="line">    </div><div class="line">    </div><div class="line">    //2.</div><div class="line">    //æ¢å¤æºåï¼Œå°±å¯ä»¥é€šè¿‡dispatch_source_merge_dataå‘Dispatch Source(åˆ†æ´¾æº)å‘é€äº‹ä»¶:</div><div class="line">    //ä¸ºäº†ä¾¿äºè§‚å¯Ÿï¼Œå°†_queueåšæˆâ€œä¸²è¡Œé˜Ÿåˆ—â€</div><div class="line">    _queue = dispatch_queue_create(&quot;com.ioschengxuyuan.queue1&quot;, 0);</div><div class="line">    NSLog(@&quot;ğŸ”´ç±»åä¸æ–¹æ³•åï¼š%sï¼ˆåœ¨ç¬¬%dè¡Œï¼‰ï¼Œæè¿°ï¼š%@&quot;, __PRETTY_FUNCTION__, __LINE__, @&quot;å¯åŠ¨é˜Ÿåˆ—&quot;);</div><div class="line">    for (NSUInteger index = 0; index &lt; CYLTotalNumber; index++) &#123;</div><div class="line">        dispatch_async(_queue, ^&#123;</div><div class="line">            if (!self.running) &#123;</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line">            dispatch_source_merge_data(_processingQueueSource, 1);</div><div class="line">            usleep(200000);//0.2ç§’</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)didReceiveMemoryWarning &#123;</div><div class="line">    [super didReceiveMemoryWarning];</div><div class="line">    [self changeStatus:self.running];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)changeStatus:(BOOL)shouldPause &#123;</div><div class="line">    if (shouldPause) &#123;</div><div class="line">        [self pause];</div><div class="line">    &#125; else &#123;</div><div class="line">        [self resume];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)resume &#123;</div><div class="line">    if (self.running) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;âœ…æ¢å¤Dispatch Source(åˆ†æ´¾æº)ä»¥åŠ_queue&quot;);</div><div class="line">    self.running = YES;</div><div class="line">    dispatch_resume(_processingQueueSource);</div><div class="line">    if (_queue) &#123;</div><div class="line">        dispatch_resume(_queue);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)pause &#123;</div><div class="line">    if (!self.running) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;ğŸš«æš‚åœDispatch Source(åˆ†æ´¾æº)ä»¥åŠ_queue&quot;);</div><div class="line">    self.running = NO;</div><div class="line">    dispatch_suspend(_processingQueueSource);</div><div class="line">    dispatch_suspend(_queue);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://i61.tinypic.com/33m06er.jpg" alt="enter image description here"></p>
<p>è¯¦è§ Demo4ï¼ˆDemo<em>04</em>å¯¹DispatchQueueå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_ç»¼åˆç‰ˆï¼‰</p>
<h2 id="Parse-â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œçš„ä»£ç æ‘˜å½•"><a href="#Parse-â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œçš„ä»£ç æ‘˜å½•" class="headerlink" title="Parse â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œçš„ä»£ç æ‘˜å½•"></a>Parse â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œçš„ä»£ç æ‘˜å½•</h2><p>å¥æŸ„å¦‚ä¸‹ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dispatch_source_set_event_handler(_processingQueueSource, ^&#123;</div><div class="line">    [self _runCommands];</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>ä½•æ—¶ä¼šè°ƒç”¨å¥æŸ„ï¼Ÿ ä¸‹é¢å°† Parse é‡Œæ¶‰åŠè°ƒç”¨å¥æŸ„çš„è¯­å¥ç½—åˆ—ä¸€ä¸‹ï¼Œ å› ä¸ºæ‘˜å½•çš„ä»£ç ä¸å®Œæ•´ï¼Œå¯èƒ½å¹¶ä¸èƒ½çœ‹å‡ºä½¿ç”¨çš„å®Œæ•´è¿‡ç¨‹ã€‚æ‰€ä»¥å¯ä»¥å¤§è‡´é¢„è§ˆä¸€ä¸‹ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹Parse æºç ï¼Œå¹¶ä¸”æˆ‘å·²å°†è¿™äº›é€»è¾‘æµ“ç¼©ä¸ºå¯è¿è¡Œçš„ Demoï¼Œä¹Ÿå¯æ­é…ç†è§£ã€‚</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)start &#123;</div><div class="line">    dispatch_source_set_event_handler(_processingQueueSource, ^&#123;</div><div class="line">        [self _runCommands];</div><div class="line">    &#125;);</div><div class="line">    [self resume];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)resume &#123;</div><div class="line">    if (self.running) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    self.running = YES;</div><div class="line">    dispatch_resume(_processingQueueSource);</div><div class="line">    dispatch_source_merge_data(_processingQueueSource, 1);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç›‘å¬ç½‘ç»œçŠ¶æ€ï¼Œä¸€æ—¦ç½‘ç»œé‡è¿ä¸Šä¹‹åï¼Œè®¾ç½® connectedå±æ€§ä¸º YESï¼Œå¹¶é‡å†™å…¶ setter æ–¹æ³•ï¼Œè°ƒç”¨ <code>dispatch_source_merge_data</code> è¿›è¡Œå‘é€æ¶ˆæ¯çš„æ“ä½œï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">/*! Manually sets the network connection status. */</div><div class="line">- (void)setConnected:(BOOL)connected &#123;</div><div class="line">    BFTaskCompletionSource *barrier = [BFTaskCompletionSource taskCompletionSource];</div><div class="line">    dispatch_async(_processingQueue, ^&#123;</div><div class="line">        dispatch_sync(_synchronizationQueue, ^&#123;</div><div class="line">            if (self.connected != connected) &#123;</div><div class="line">                _connected = connected;</div><div class="line">                if (connected) &#123;</div><div class="line">                    dispatch_source_merge_data(_processingQueueSource, 1);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        barrier.result = nil;</div><div class="line">    &#125;);</div><div class="line">    if (connected) &#123;</div><div class="line">        dispatch_async(_synchronizationQueue, ^&#123;</div><div class="line">            if (_retryingSemaphore) &#123;</div><div class="line">                dispatch_semaphore_signal(_retryingSemaphore);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    [barrier.task waitForResult:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)_didEnqueueCommand:(id&lt;PFNetworkCommand&gt;)command</div><div class="line">            withIdentifier:(NSString *)identifier</div><div class="line">      taskCompletionSource:(BFTaskCompletionSource *)taskCompletionSource &#123;</div><div class="line">    PFAssertIsOnDispatchQueue(_synchronizationQueue);</div><div class="line"></div><div class="line">    _taskCompletionSources[identifier] = taskCompletionSource;</div><div class="line">    dispatch_source_merge_data(_processingQueueSource, 1);</div><div class="line"></div><div class="line">    if (_retryingSemaphore) &#123;</div><div class="line">        dispatch_semaphore_signal(_retryingSemaphore);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Dispatch-Semaphore-ä¿¡å·é‡"><a href="#Dispatch-Semaphore-ä¿¡å·é‡" class="headerlink" title="Dispatch Semaphore ä¿¡å·é‡"></a><code>Dispatch Semaphore</code> ä¿¡å·é‡</h2><p>ä¸ºäº†å±•ç¤ºä½œç”¨ï¼Œä¸¾ä¸ªåä¾‹ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">NSMutableArray *array = [[NSMutableArray alloc] init];</div><div class="line">dispatch_group_t group = dispatch_group_create();</div><div class="line">for(int i = 0; i&lt; 100000; ++i) &#123;</div><div class="line">    dispatch_group_async(group, queue, ^&#123;</div><div class="line">        [array addObject:[NSNumber numberWithInt:i]];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line">dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</div><div class="line">NSLog(@&quot;%@&quot;,  @([array count]));</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœç»å¯¹å¤§è·Œçœ¼é•œï¼š</p>
<p>æˆ‘è¿è¡Œäº†ä¸‰æ¬¡ï¼Œä¸‰æ¬¡ç»“æœå‡ä¸ä¸€è‡´ï¼š</p>
<ol>
<li><p>ç¬¬ä¸€æ¬¡ï¼šå´©æºƒã€‚ã€‚ã€‚</p>
<p><img src="http://i67.tinypic.com/29vxt9w.jpg" alt="enter image description here"></p>
</li>
</ol>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">CYLDispatchSemaphoreTest(10384,0x112d43000) malloc: *** error for object 0x7f898487ca00: pointer being freed was not allocated</div><div class="line">*** set a breakpoint in malloc_error_break to debug</div><div class="line">(lldb)</div></pre></td></tr></table></figure>
<ol>
<li><p>ç¬¬äºŒæ¬¡ï¼šä¸å¤Ÿã€‚ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2015-09-07 00:42:20.145 CYLDispatchSemaphoreTest[10417:779722] 99996</div></pre></td></tr></table></figure>
</li>
<li><p>ç¬¬ä¸‰æ¬¡ï¼šè¿˜æ˜¯ä¸å¤Ÿã€‚ã€‚ã€‚</p>
</li>
</ol>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2015-09-07 00:42:52.734 CYLDispatchSemaphoreTest[10438:780505] 99949</div></pre></td></tr></table></figure>
<p>è¿™ç§èµ„æºæŠ¢å¤ºçš„æƒ…å†µï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—ï¼Œæˆ–è€…åƒä¸‹é¢ä¸€æ ·çš„åŒæ­¥é˜Ÿåˆ—ï¼Œå¾—ä»¥è§£å†³ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">   NSMutableArray *array = [[NSMutableArray alloc] init];</div><div class="line">   for(int i = 0; i&lt; 100000; ++i) &#123;</div><div class="line">       dispatch_sync(queue, ^&#123;</div><div class="line">           [array addObject:[NSNumber numberWithInt:i]];</div><div class="line">       &#125;);</div><div class="line"></div><div class="line">   &#125;</div><div class="line">   NSLog(@&quot;%@&quot;, @([array count]));</div></pre></td></tr></table></figure>
<p>ä¸‹é¢å±•ç¤ºä¸‹å±•ç¤ºä½¿ç”¨ <code>dispatch_semaphore_t</code> çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<p> <code>dispatch_semaphore_t</code> çš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯è§£å†³è¿™ç§èµ„æºæŠ¢å¤ºçš„æƒ…å†µï¼Œä¸‹é¢å±•ç¤ºä¸‹ä½¿ç”¨ <code>dispatch_semaphore_t</code> å®ç°ä¸€ä¸ªèµ„æºé”ï¼š</p>
<p>ä»¥ä¸‹æºç è¯¦è§ Demo6ï¼ˆDemo<em>06</em>å±•ç¤ºdispatch_semaphore_tåŸºæœ¬ç”¨æ³•ï¼‰</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    //å› ä¸ºç”¨åˆ°äº†dispatch_barrier_asyncï¼Œè¯¥å‡½æ•°åªèƒ½æ­é…è‡ªå®šä¹‰å¹¶è¡Œé˜Ÿåˆ—dispatch_queue_tä½¿ç”¨ã€‚æ‰€ä»¥ä¸èƒ½ä½¿ç”¨ï¼šdispatch_get_global_queue</div><div class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;com.ioschengxuyuan.gcd.ForBarrier&quot;, DISPATCH_QUEUE_CONCURRENT);</div><div class="line">    /*</div><div class="line">     *</div><div class="line">     *ç”ŸæˆDispatch Semaphore</div><div class="line">     Dispatch Semaphore çš„è®¡æ•°åˆå§‹å€¼è®¾å®šä¸ºâ€œ1â€</div><div class="line">     (è¯¥åˆå§‹å€¼çš„1ä¸ä¸‹æ–‡ä¸­ä¸¤ä¸ªå‡½æ•°dispatch_semaphore_waitä¸dispatch_semaphore_signalè¿›è¡Œçš„å‡1ã€åŠ 1é‡Œçš„1æ²¡æœ‰å¿…ç„¶è”ç³»ã€‚</div><div class="line">     </div><div class="line">     å°±ç®—åˆå§‹å€¼æ˜¯100ï¼Œä¸¤ä¸ªå‡½æ•°dispatch_semaphore_waitä¸dispatch_semaphore_signalè¿˜æ˜¯ä¼šå‡â€œ1â€ã€åŠ â€œ1â€)ã€‚</div><div class="line">     ä¿è¯å¯è®¿é—® NSMutableArray ç±»å¯¹è±¡çš„çº¿ç¨‹</div><div class="line">     åŒæ—¶åªèƒ½æœ‰1ä¸ª</div><div class="line">     *</div><div class="line">     */</div><div class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(1) ;</div><div class="line">    NSMutableArray *array = [[NSMutableArray alloc] init];</div><div class="line">    for(int i = 0; i&lt; 100000; ++i) &#123;</div><div class="line">        dispatch_async(queue, ^&#123;</div><div class="line">            /*</div><div class="line">             *</div><div class="line">             *ç­‰å¾…Dispatch Semaphore</div><div class="line">             *ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°Dispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº1</div><div class="line">             */</div><div class="line">            dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER) ;</div><div class="line">            /*</div><div class="line">             *ç”±äºDispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº1</div><div class="line">             *æ‰€ä»¥å°†Dispatch Semaphoreçš„è®¡æ•°å€¼å‡å»1</div><div class="line">             *dispatch_semaphore_wait å‡½æ•°æ‰§è¡Œè¿”å›ã€‚</div><div class="line">             *å³æ‰§è¡Œåˆ°æ­¤æ—¶çš„</div><div class="line">             *Dispatch Semaphore çš„è®¡æ•°å€¼æ’ä¸º0</div><div class="line">             *</div><div class="line">             *ç”±äºå¯è®¿é—®NSMutaleArrayç±»å¯¹è±¡çš„çº¿ç¨‹</div><div class="line">             *åªæœ‰ä¸€ä¸ª</div><div class="line">             *å› æ­¤å¯å®‰å…¨åœ°è¿›è¡Œæ›´æ–°</div><div class="line">             *</div><div class="line">             */</div><div class="line">            NSLog(@&quot;ğŸ”´%@&quot;,[NSThread currentThread]);</div><div class="line">            [array addObject:[NSNumber numberWithInt:i]];</div><div class="line">            /*</div><div class="line">             *</div><div class="line">             *æ’ä»–æ§åˆ¶å¤„ç†ç»“æŸï¼Œ</div><div class="line">             *æ‰€ä»¥é€šè¿‡dispatch_semaphore_signalå‡½æ•°</div><div class="line">             *å°†Dispatch Semaphoreçš„è®¡æ•°å€¼åŠ 1</div><div class="line">             *å¦‚æœæœ‰é€šè¿‡dispatch_semaphore_waitå‡½æ•°</div><div class="line">             *ç­‰å¾…Dispatch Semaphoreçš„è®¡æ•°å€¼å¢åŠ çš„çº¿ç¨‹ï¼Œ</div><div class="line">             â˜…å°±ç”±æœ€å…ˆç­‰å¾…çš„çº¿ç¨‹æ‰§è¡Œã€‚</div><div class="line">             */</div><div class="line">            dispatch_semaphore_signal(semaphore);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    /*</div><div class="line">     *</div><div class="line">     ç­‰ä¸ºæ•°ç»„éå†æ·»åŠ å…ƒç´ åï¼Œæ£€æŸ¥ä¸‹æ•°ç»„çš„æˆå‘˜ä¸ªæ•°æ˜¯å¦æ­£ç¡®</div><div class="line">     *</div><div class="line">     */</div><div class="line">    dispatch_barrier_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;ğŸ”´ç±»åä¸æ–¹æ³•åï¼š%sï¼ˆåœ¨ç¬¬%dè¡Œï¼‰ï¼Œæè¿°ï¼š%@&quot;, __PRETTY_FUNCTION__, __LINE__, @([array count]));</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸ºäº†åŠ æ·±å¯¹dispatch_semaphore_tåŸºæœ¬ç”¨æ³•çš„ç†è§£ï¼Œå†ç»™ä¸€ä¸ªç¤ºä¾‹ Demoï¼š</p>
<p>æ€è€ƒä¸‹ä¸ºä½•ä¼šå¦‚ä½•æ‰“å°ï¼š<br>ç„¶åå†åˆ†åˆ«è¯•ä¸€ä¸‹ç¬¬ä¸‰è¡Œå’Œç¬¬å››è¡Œï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</div><div class="line">//    dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);</div></pre></td></tr></table></figure>
<p>ç„¶åè§‚å¯Ÿä¸‹æ‰“å°ã€‚</p>
<p>è¯¦è§ Demo5ï¼ˆDemo<em>05</em>å±•ç¤ºdispatch_semaphore_tåŸºæœ¬ç”¨æ³•ï¼‰</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</div><div class="line">//    dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);</div><div class="line">    </div><div class="line">    dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, 1ull * NSEC_PER_SEC);//ç­‰å¾…ä¸€ç§’</div><div class="line">    //dispatch_time_t time = DISPATCH_TIME_FOREVER;//æ°¸ä¹…ç­‰å¾…</div><div class="line">    NSLog(@&quot;begin ==&gt;  è½¦åº“å¼€å§‹è¥ä¸šäº†ï¼&quot;);</div><div class="line">    /*</div><div class="line">     *</div><div class="line">     å¦‚æœ semphore çš„å€¼ç­‰äº0ï¼Œå°±é˜»å¡1ç§’é’Ÿï¼Œæ‰ä¼šå¾€ä¸‹ç…§å¸¸è¿›è¡Œï¼›</div><div class="line">     å¦‚æœå¤§äºç­‰äº1åˆ™å¾€ä¸‹è¿›è¡Œå¹¶å°† semphore è¿›è¡Œå‡1å¤„ç†ã€‚</div><div class="line">     *</div><div class="line">     */</div><div class="line">    long result = dispatch_semaphore_wait(semaphore, time);</div><div class="line">    if (result == 0) &#123;</div><div class="line">        /*</div><div class="line">         *</div><div class="line">         *ç”±å­Dispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº1</div><div class="line">         *æˆ–è€…åœ¨å¾…æœºä¸­çš„æŒ‡å®šæ—¶é—´å†…</div><div class="line">         *Dispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº1</div><div class="line">         æ‰€ä»¥Dispatch Semaphoreçš„è®¡æ•°å€¼å‡å»1</div><div class="line">         å¯æ‰§è¡Œéœ€è¦è¿›è¡Œæ’ä»–æ§åˆ¶çš„å¤„ç†.</div><div class="line">         å¯ä»¥ç†è§£ä¸ºï¼šæ²¡æœ‰é˜»å¡çš„çº¿ç¨‹äº†ã€‚</div><div class="line">         å°±å¥½æ¯”ï¼šè½¦åº“æœ‰ä¸€ä¸ªæˆ–ä¸€ä¸ªä»¥ä¸Šçš„è½¦ä½ï¼Œåªæ¥äº†ä¸€è¾†è½¦ï¼Œæ‰€ä»¥â€œæ— éœ€ç­‰å¾…â€</div><div class="line">         *</div><div class="line">         */</div><div class="line">        NSLog(@&quot;result = 0 ==&gt; æœ‰è½¦ä½ï¼Œæ— éœ€ç­‰å¾…ï¼==&gt; åœ¨è¿™é‡Œå¯å®‰å…¨åœ°æ‰§è¡Œã€éœ€è¦æ’ä»–æ§åˆ¶çš„å¤„ç†ï¼ˆæ¯”å¦‚åªå…è®¸ä¸€æ¡çº¿ç¨‹ä¸ºmutableArrayè¿›è¡ŒaddObjæ“ä½œï¼‰ã€‘&quot;);</div><div class="line">        dispatch_semaphore_signal(semaphore);//ä½¿ç”¨signalä»¥ç¡®ä¿ç¼–è¯‘å™¨releaseæ‰dispatch_semaphore_tæ—¶çš„å€¼ä¸åˆå§‹å€¼ä¸€è‡´ï¼Œ å¦åˆ™ä¼šEXC_BAD_INSTRUCTION ,è§http://is.gd/EaJgk5</div><div class="line">    &#125; else &#123;</div><div class="line">        /*</div><div class="line">         *</div><div class="line">         *ç”±äºDispatch Semaphoreçš„è®¡æ•°å€¼ä¸º0</div><div class="line">         .å› æ­¤åœ¨è¾¾åˆ°æŒ‡å®šæ—¶é—´ä¸ºæ­¢å¾…æœº</div><div class="line">         è¿™ä¸ªelseé‡Œå‘ç”Ÿçš„äº‹æƒ…ï¼Œå°±å¥½æ¯”ï¼šè½¦åº“æ²¡è½¦ä½ï¼Œæ¥äº†ä¸€è¾†è½¦ï¼Œç­‰å¾…äº†åŠä¸ªå°æ—¶åï¼Œåšå‡ºçš„ä¸€äº›äº‹æƒ…ã€‚</div><div class="line">         æ¯”å¦‚ï¼šå¿å—ä¸äº†ï¼Œèµ°äº†ã€‚ã€‚</div><div class="line">         *</div><div class="line">         */</div><div class="line">        NSLog(@&quot;result != 0 ==&gt; timeoutï¼Œdeadlineï¼Œå¿å—ä¸äº†ï¼Œèµ°äº†ã€‚ã€‚&quot;);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•"><a href="#åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•" class="headerlink" title="åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•"></a>åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•</h3><p>ä¸‹é¢æ˜¯ Parse çš„ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> @interface PFEventuallyQueueTestHelper : NSObject &#123;</div><div class="line">    dispatch_semaphore_t events[PFEventuallyQueueEventCount];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)clear;</div><div class="line">- (void)notify:(PFEventuallyQueueTestHelperEvent)event;</div><div class="line">- (BOOL)waitFor:(PFEventuallyQueueTestHelperEvent)event;</div></pre></td></tr></table></figure>
<p>æ³¨é‡Šæ˜¯è¿™æ ·å†™çš„ï¼š</p>
<blockquote>
<p>PFEventuallyQueueTestHelper gets notifications of various events happening in the command cache,<br>// so that tests can be synchronized. See CommandTests.m for examples of how to use this.</p>
</blockquote>
<p>å¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚è¿™ä¸ªç”¨é€”ä¿¡å·é‡æ˜¯æœ€åˆé€‚çš„ç”¨é€”ã€‚ä½†æ³¨æ„å¹¶ä¸æ¨èåº”ç”¨åˆ°é™¤æ­¤ä¹‹å¤–çš„å…¶å®ƒåœºæ™¯ï¼</p>
<p>è¿™ç§å¼‚æ­¥è½¬åŒæ­¥ä¾¿äºå•å…ƒæµ‹è¯•çš„ç”¨æ³•ç±»ä¼¼äºä¸‹é¢çš„å†™æ³•ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#define WAIT_FOREVER [self waitForStatus:XCTAsyncTestCaseStatusSucceeded timeout:DBL_MAX];</div><div class="line">#define NOTIFY [self notify:XCTAsyncTestCaseStatusSucceeded];</div></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)testInstallationMutated &#123;</div><div class="line">    NSDictionary *dict = [self jsonWithFileName:@&quot;TestInstallationSave&quot;];</div><div class="line">    AVInstallation *installation = [AVInstallation currentInstallation];</div><div class="line">    [installation objectFromDictionary:dict];</div><div class="line">    [installation setObject:@(YES) forKey:@&quot;enableNoDisturb&quot;];</div><div class="line">    [installation saveInBackgroundWithBlock:^(BOOL succeeded, NSError *error) &#123;</div><div class="line">        XCTAssertNil(error);</div><div class="line">        NOTIFY;</div><div class="line">    &#125;];</div><div class="line">    WAIT;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¿¡å·é‡å±æ€§åº•å±‚å·¥å…·ï¼Œä»–è™½ç„¶éå¸¸å¼ºå¤§ï¼Œä½†åœ¨å¤šæ•°éœ€è¦ä½¿ç”¨å®ƒçš„åœºåˆï¼Œæœ€å¥½ä»è®¾è®¡è§’åº¦é‡æ–°è€ƒè™‘ï¼Œçœ‹æ˜¯å¦å¯ä»¥ä¸ç”¨ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¯¸å¦‚æ“ä½œé˜Ÿåˆ—è¿™æ ·çš„é«˜çº§å·¥å…·ã€‚é€šå¸¸å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªåˆ†æ´¾é˜Ÿåˆ—é…åˆ  <code>dispatch_suspend</code> ï¼Œæˆ–è€…é€šè¿‡å…¶å®ƒæ–¹å¼åˆ†è§£æ“ä½œæ¥é¿å…ä½¿ç”¨ä¿¡å·é‡ã€‚ä¿¡å·é‡å¹¶éä¸å¥½ï¼Œåªæ˜¯å®ƒæœ¬èº«æ˜¯é”ï¼Œèƒ½ä¸ä½¿ç”¨å°±ä¸ç”¨ã€‚å°½é‡ç”¨ cocoa æ¡†æ¶ä¸­çš„é«˜çº§æŠ½è±¡ï¼Œä¿¡å·é‡éå¸¸æ¥è¿‘åº•å±‚ã€‚æ‰€ä»¥é™¤äº†ä¸Šé¢çš„ä¾‹å­æ˜¯æœ€ä½³åº”ç”¨åœºæ™¯å¤–ï¼Œä¸æ¨èåº”ç”¨åˆ°é™¤æ­¤ä¹‹å¤–çš„å…¶å®ƒåœºæ™¯ï¼</p>
<p> <a href="http://www.cnblogs.com/snailHL/p/3906112.html" target="_blank" rel="external">ã€Šå…³äºdispatch_semaphoreçš„ä½¿ç”¨ã€‹</a> ä¸­æœ‰è¿™æ ·çš„æè¿°ï¼š</p>
<p>å…³äºä¿¡å·é‡ï¼Œä¸€èˆ¬å¯ä»¥ç”¨åœè½¦æ¥æ¯”å–»ã€‚</p>
<blockquote>
<p>ã€€ã€€åœè½¦åœºå‰©ä½™4ä¸ªè½¦ä½ï¼Œé‚£ä¹ˆå³ä½¿åŒæ—¶æ¥äº†å››è¾†è½¦ä¹Ÿèƒ½åœçš„ä¸‹ã€‚å¦‚æœæ­¤æ—¶æ¥äº†äº”è¾†è½¦ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€è¾†éœ€è¦ç­‰å¾…ã€‚</p>
<p>ã€€ã€€ä¿¡å·é‡çš„å€¼å°±ç›¸å½“äºå‰©ä½™è½¦ä½çš„æ•°ç›®ï¼Œdispatch_semaphore_waitå‡½æ•°å°±ç›¸å½“äºæ¥äº†ä¸€è¾†è½¦ï¼Œ</p>
<p>ã€€ã€€dispatch_semaphore_signalï¼Œå°±ç›¸å½“äºèµ°äº†ä¸€è¾†è½¦ã€‚åœè½¦ä½çš„å‰©ä½™æ•°ç›®åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±å·²ç»æŒ‡æ˜äº†ï¼ˆdispatch_semaphore_createï¼ˆlong valueï¼‰ï¼‰</p>
<p>ã€€ã€€è°ƒç”¨ä¸€æ¬¡dispatch_semaphore_signalï¼Œå‰©ä½™çš„è½¦ä½å°±å¢åŠ ä¸€ä¸ªï¼›è°ƒç”¨ä¸€æ¬¡dispatch_semaphore_waitå‰©ä½™è½¦ä½å°±å‡å°‘ä¸€ä¸ªï¼›</p>
<p>ã€€ã€€å½“å‰©ä½™è½¦ä½ä¸º0æ—¶ï¼Œå†æ¥è½¦ï¼ˆå³è°ƒç”¨dispatch_semaphore_waitï¼‰å°±åªèƒ½ç­‰å¾…ã€‚æœ‰å¯èƒ½åŒæ—¶æœ‰å‡ è¾†è½¦ç­‰å¾…ä¸€ä¸ªåœè½¦ä½ã€‚æœ‰äº›è½¦ä¸»</p>
<p>ã€€ã€€æ²¡æœ‰è€å¿ƒï¼Œç»™è‡ªå·±è®¾å®šäº†ä¸€æ®µç­‰å¾…æ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…ç­‰ä¸åˆ°åœè½¦ä½å°±èµ°äº†ï¼Œå¦‚æœç­‰åˆ°äº†å°±å¼€è¿›å»åœè½¦ã€‚è€Œæœ‰äº›è½¦ä¸»å°±åƒæŠŠè½¦åœåœ¨è¿™ï¼Œ</p>
<p>ã€€ã€€æ‰€ä»¥å°±ä¸€ç›´ç­‰ä¸‹å»ã€‚</p>
</blockquote>
<p> <a href="http://m.blog.csdn.net/blog/choudang/38121827" target="_blank" rel="external">ã€ŠGCD dispatch_semaphore ä¿¡å·é‡ åè°ƒçº¿ç¨‹åŒæ­¥ã€‹</a> ä¹Ÿæœ‰ç±»ä¼¼çš„æ¯”å–»ï¼š</p>
<blockquote>
<p>ä»¥ä¸€ä¸ªåœè½¦åœºæ˜¯è¿ä½œä¸ºä¾‹ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œå‡è®¾åœè½¦åœºåªæœ‰ä¸‰ä¸ªè½¦ä½ï¼Œä¸€å¼€å§‹ä¸‰ä¸ªè½¦ä½éƒ½æ˜¯ç©ºçš„ã€‚è¿™æ—¶å¦‚æœåŒæ—¶æ¥äº†äº”è¾†è½¦ï¼Œçœ‹é—¨äººå…è®¸å…¶ä¸­ä¸‰è¾†ä¸å—é˜»ç¢çš„è¿›å…¥ï¼Œç„¶åæ”¾ä¸‹è½¦æ‹¦ï¼Œå‰©ä¸‹çš„è½¦åˆ™å¿…é¡»åœ¨å…¥å£ç­‰å¾…ï¼Œæ­¤åæ¥çš„è½¦ä¹Ÿéƒ½ä¸å¾—ä¸åœ¨å…¥å£å¤„ç­‰å¾…ã€‚è¿™æ—¶ï¼Œæœ‰ä¸€è¾†è½¦ç¦»å¼€åœè½¦åœºï¼Œçœ‹é—¨äººå¾—çŸ¥åï¼Œæ‰“å¼€è½¦æ‹¦ï¼Œæ”¾å…¥ä¸€è¾†ï¼Œå¦‚æœåˆç¦»å¼€ä¸¤è¾†ï¼Œåˆ™åˆå¯ä»¥æ”¾å…¥ä¸¤è¾†ï¼Œå¦‚æ­¤å¾€å¤ã€‚<br></p> åœ¨è¿™ä¸ªåœè½¦åœºç³»ç»Ÿä¸­ï¼Œè½¦ä½æ˜¯å…¬å…±èµ„æºï¼Œæ¯è¾†è½¦å¥½æ¯”ä¸€ä¸ªçº¿ç¨‹ï¼Œçœ‹é—¨äººèµ·çš„å°±æ˜¯ä¿¡å·é‡çš„ä½œç”¨ã€‚<br>æ›´è¿›ä¸€æ­¥ï¼Œä¿¡å·é‡çš„ç‰¹æ€§å¦‚ä¸‹ï¼šä¿¡å·é‡æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼ˆè½¦ä½æ•°ï¼‰ï¼Œæ‰€æœ‰é€šè¿‡å®ƒçš„çº¿ç¨‹ï¼ˆè½¦è¾†ï¼‰éƒ½ä¼šå°†è¯¥æ•´æ•°å‡ä¸€ï¼ˆé€šè¿‡å®ƒå½“ç„¶æ˜¯ä¸ºäº†ä½¿ç”¨èµ„æºï¼‰ï¼Œå½“è¯¥æ•´æ•°å€¼ä¸ºé›¶æ—¶ï¼Œæ‰€æœ‰è¯•å›¾é€šè¿‡å®ƒçš„çº¿ç¨‹éƒ½å°†å¤„äºç­‰å¾…çŠ¶æ€ã€‚åœ¨ä¿¡å·é‡ä¸Šæˆ‘ä»¬å®šä¹‰ä¸¤ç§æ“ä½œï¼š Waitï¼ˆç­‰å¾…ï¼‰ å’Œ Releaseï¼ˆé‡Šæ”¾ï¼‰ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨Waitï¼ˆç­‰å¾…ï¼‰æ“ä½œæ—¶ï¼Œå®ƒè¦ä¹ˆé€šè¿‡ç„¶åå°†ä¿¡å·é‡å‡ä¸€ï¼Œè¦ä¹ˆä¸€ç›´ç­‰ä¸‹å»ï¼Œç›´åˆ°ä¿¡å·é‡å¤§äºä¸€æˆ–è¶…æ—¶ã€‚Releaseï¼ˆé‡Šæ”¾ï¼‰å®é™…ä¸Šæ˜¯åœ¨ä¿¡å·é‡ä¸Šæ‰§è¡ŒåŠ æ“ä½œï¼Œå¯¹åº”äºè½¦è¾†ç¦»å¼€åœè½¦åœºï¼Œè¯¥æ“ä½œä¹‹æ‰€ä»¥å«åšâ€œé‡Šæ”¾â€æ˜¯å› ä¸ºåŠ æ“ä½œå®é™…ä¸Šæ˜¯é‡Šæ”¾äº†ç”±ä¿¡å·é‡å®ˆæŠ¤çš„èµ„æºã€‚<p></p>
</blockquote>
<p>è¿™ä¸ªæ¯”å–»é‡Œå¯ä»¥ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥è¡¨ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>å–»ä½“</th>
<th>æœ¬ä½“</th>
<th>ä»£ç </th>
</tr>
</thead>
<tbody>
<tr>
<td>è½¦ä½</td>
<td>ä¿¡å·é‡</td>
<td><code>dispatch_semaphore_t</code>  </td>
</tr>
<tr>
<td>å‰©ä½™å‡ ä¸ªè½¦ä½</td>
<td>æœ€å¤§å¹¶å‘çº¿ç¨‹</td>
<td><code>dispatch_semaphore_t</code>  </td>
</tr>
<tr>
<td>çœ‹é—¨äººèµ·çš„ä½œç”¨</td>
<td>ä¿¡å·é‡çš„ä½œç”¨</td>
<td><code>dispatch_semaphore_t</code>  </td>
</tr>
<tr>
<td>è½¦</td>
<td>çº¿ç¨‹</td>
<td>ä»£ç  </td>
</tr>
<tr>
<td>è€å¿ƒçš„æé™æ—¶é—´</td>
<td>è¶…æ—¶æ—¶é—´</td>
<td><code>dispatch_semaphore_wait</code>  </td>
</tr>
<tr>
<td>é€›è¡—ç»“æŸèµ°äº†ï¼Œç¦»å¼€è½¦ä½</td>
<td>signal+1</td>
<td><code>dispatch_semaphore_signal</code>  </td>
</tr>
</tbody>
</table>
<h3 id="ä½¿ç”¨Dispatch-Semaphoreæ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡"><a href="#ä½¿ç”¨Dispatch-Semaphoreæ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡" class="headerlink" title="ä½¿ç”¨Dispatch Semaphoreæ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡"></a>ä½¿ç”¨<code>Dispatch Semaphore</code>æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡</h3><p>æ­£å¦‚æ–‡ç« å¼€å¤´æ‰€è¯´ï¼šä» iOS7 å‡åˆ° iOS8 åï¼ŒGCD å‡ºç°äº†ä¸€ä¸ªé‡å¤§çš„å˜åŒ–ï¼šåœ¨ iOS7 æ—¶ï¼Œä½¿ç”¨ GCD çš„å¹¶è¡Œé˜Ÿåˆ—ï¼Œ  <code>dispatch_async</code>  æœ€å¤§å¼€å¯çš„çº¿ç¨‹ä¸€ç›´èƒ½æ§åˆ¶åœ¨6ã€7æ¡ï¼Œçº¿ç¨‹æ•°éƒ½æ˜¯ä¸ªä½æ•°ï¼Œç„¶è€Œ iOS8åï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸€åº¦å¯ä»¥è¾¾åˆ°40æ¡ã€50æ¡ã€‚ç„¶è€Œåœ¨æ–‡æ¡£ä¸Šå¹¶æ²¡æœ‰å¯¹è¿™ä¸€åšæ³•çš„ç›®çš„è¿›è¡Œä»‹ç»ã€‚</p>
<p>ç¬”è€…æ¨æµ‹ Apple çš„ç›®çš„æ˜¯æƒ³å€Ÿæ­¤è®©å¼€å‘è€…ä½¿ç”¨ <code>NSOperationQueue</code> ï¼šGCD ä¸­ Apple å¹¶æ²¡æœ‰æä¾›æ§åˆ¶å¹¶å‘æ•°é‡çš„æ¥å£ï¼Œè€Œ  <code>NSOperationQueue</code>  æœ‰ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ GCD å®ç°ï¼Œéœ€è¦ä½¿ç”¨ GCD çš„ä¸€é¡¹é«˜çº§åŠŸèƒ½ï¼š<code>Dispatch Semaphore</code>ä¿¡å·é‡ã€‚</p>
<p>è¯¦è§ Demo7ï¼ˆDemo<em>07</em>å±•ç¤ºdispatch_semaphore_tæ§åˆ¶çº¿ç¨‹å¹¶å‘æ•°é‡çš„ç”¨æ³•ï¼‰</p>
<p>Demo7ä¸­ä½¿ç”¨äº† <a href="http://mp.weixin.qq.com/s?__biz=MzAxNDAzMzk0MQ==&amp;mid=203702345&amp;idx=1&amp;sn=226f6f784d37b89718f6949c9214e1e6&amp;scene=1&amp;srcid=kl2ZmcSfYHuB6bMvYPEq#rd" target="_blank" rel="external">è¿™ç¯‡åšæ–‡</a> ä¸­çš„ä¾‹å­ã€‚</p>
<p><code>Dispatch Semaphore</code>ä¿¡å·é‡çš„ä½¿ç”¨åœ¨ä¸Šæ–‡ä¸­å·²ç»ä»‹ç»è¿‡ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä¸Š Demoï¼š</p>
<p>ä¸»è¦åšçš„å°±æ˜¯å°†ä¸Šæ–‡ä¸­ <code>dispatch_semaphore_t</code> çš„ä¸ªæ•°è®¾ç½®ä¸ºä¸€ä¸ªå¯å˜å‚æ•°ï¼šè¿™æ ·å°±è¾¾åˆ°äº†æ§åˆ¶å¹¶è¡Œçº¿ç¨‹æ•°é‡çš„ç›®çš„ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"> *</div><div class="line"> ç®€å•ç‰ˆæœ¬ï¼šæ— ä¸“é—¨æ§åˆ¶å¹¶å‘ç­‰å¾…çš„çº¿ç¨‹ï¼Œç¼ºç‚¹é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯ä»¥è·‘ä¸€ä¸‹ demoï¼Œä½ ä¼šå‘ç°ä¸»å±å¹•ä¸Šçš„æŒ‰é’®æ˜¯ä¸å¯ç‚¹å‡»çš„</div><div class="line"> *</div><div class="line"> */</div><div class="line">void dispatch_async_limit(dispatch_queue_t queue,NSUInteger limitSemaphoreCount, dispatch_block_t block) &#123;</div><div class="line">    //æ§åˆ¶å¹¶å‘æ•°çš„ä¿¡å·é‡</div><div class="line">    static dispatch_semaphore_t limitSemaphore;</div><div class="line">    //ä¸“é—¨æ§åˆ¶å¹¶å‘ç­‰å¾…çš„çº¿ç¨‹</div><div class="line"></div><div class="line">    </div><div class="line">    //ä½¿ç”¨ dispatch_onceè€Œé lazy æ¨¡å¼ï¼Œé˜²æ­¢å¯èƒ½çš„å¤šçº¿ç¨‹æŠ¢å é—®é¢˜</div><div class="line">    static dispatch_once_t onceToken;</div><div class="line">    dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">        limitSemaphore = dispatch_semaphore_create(limitSemaphoreCount);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line"></div><div class="line">        //å¯ç”¨ä¿¡å·é‡åæ‰èƒ½ç»§ç»­ï¼Œå¦åˆ™ç­‰å¾…</div><div class="line">        dispatch_semaphore_wait(limitSemaphore, DISPATCH_TIME_FOREVER);</div><div class="line">        dispatch_async(queue, ^&#123;</div><div class="line">            !block ? : block();</div><div class="line">            //åœ¨è¯¥å·¥ä½œçº¿ç¨‹æ‰§è¡Œå®Œæˆåé‡Šæ”¾ä¿¡å·é‡</div><div class="line">            dispatch_semaphore_signal(limitSemaphore);</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½ å¯èƒ½å‘ç°ï¼Œè¿™æ®µä»£ç æœ‰é—®é¢˜é˜»å¡äº†å½“å‰çº¿ç¨‹ï¼ŒDemo7ä¸­ä¹Ÿç»™å‡ºäº†æ”¹è‰¯ç‰ˆï¼Œå¯ä»¥çœ‹ä¸‹ã€‚</p>
<h3 id="ä¸º-NSURLSession-æ·»åŠ åŒæ­¥æ–¹æ³•"><a href="#ä¸º-NSURLSession-æ·»åŠ åŒæ­¥æ–¹æ³•" class="headerlink" title="ä¸º  NSURLSession æ·»åŠ åŒæ­¥æ–¹æ³•"></a>ä¸º  NSURLSession æ·»åŠ åŒæ­¥æ–¹æ³•</h3><p>NSURLSession å–æ¶ˆäº†åŒæ­¥æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥å€ŸåŠ©ä¿¡å·é‡æ¥å®ç°ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">+ (NSData *)sendSynchronousRequest:(NSURLRequest *)request returningResponse:(NSURLResponse *__autoreleasing *)response error:(NSError *__autoreleasing *)error &#123;</div><div class="line">    __block NSData *data = nil;</div><div class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</div><div class="line"></div><div class="line">    [[[NSURLSession sharedSession] dataTaskWithRequest:request completionHandler:^(NSData *taskData, NSURLResponse *taskResponse, NSError *taskError) &#123;</div><div class="line">        data = taskData;</div><div class="line"></div><div class="line">        if (response)</div><div class="line">            *response = taskResponse;</div><div class="line"></div><div class="line">        if (error)</div><div class="line">            *error = taskError;</div><div class="line"></div><div class="line">        dispatch_semaphore_signal(semaphore);</div><div class="line">    &#125;] resume];</div><div class="line"></div><div class="line">    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</div><div class="line"></div><div class="line">    return data;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä¹Ÿè¦æ€è€ƒä¸‹ä¸ºä»€ä¹ˆ Apple å–æ¶ˆäº†åŒæ­¥æ–¹æ³•ï¼šåŒæ­¥æ–¹æ³•çš„é£é™©è¿œè¿œè¶…è¿‡å—ç›Šã€‚</p>
<p>è¦æ³¨æ„ï¼š</p>
<ul>
<li>é™¤éä¸‡ä¸å¾—å·²ï¼Œå¦åˆ™æ°¸è¿œä¸è¦å°è¯•åœ¨ä¸»çº¿ç¨‹ä¸Šå‘é€åŒæ­¥çš„ç½‘ç»œè¯·æ±‚</li>
<li>å°½é‡åªåœ¨åå°çº¿ç¨‹ä¸­ç‹¬å çº¿ç¨‹å‘é€åŒæ­¥çš„ç½‘ç»œè¯·æ±‚</li>
</ul>
<p>é£é™©å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<h4 id="å¯¼è‡´Watchdogè¶…æ—¶"><a href="#å¯¼è‡´Watchdogè¶…æ—¶" class="headerlink" title="å¯¼è‡´Watchdogè¶…æ—¶"></a>å¯¼è‡´Watchdogè¶…æ—¶</h4><p>å…³äºWatchdogè¶…æ—¶ï¼š</p>
<p>åœ¨  <a href="https://developer.apple.com/library/ios/qa/qa1693/_index.html" target="_blank" rel="external"> <strong><em>QA1693ï¼šSynchronous Networking On The Main Thread</em></strong> </a><br>æ–‡æ¡£ä¸­æè¿°äº†Watchdogæœºåˆ¶ï¼ŒåŒ…æ‹¬ç”Ÿæ•ˆåœºæ™¯å’Œè¡¨ç°ã€‚å¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯¹ä¸€äº›ç‰¹å®šçš„UIäº‹ä»¶ï¼ˆæ¯”å¦‚å¯åŠ¨ã€æŒ‚èµ·ã€æ¢å¤ã€ç»“æŸï¼‰å“åº”ä¸åŠæ—¶ï¼ŒWatchdogä¼šæŠŠæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹²æ‰ï¼Œå¹¶ç”Ÿæˆä¸€ä»½å“åº”çš„crashæŠ¥å‘Šã€‚</p>
<p>è¿™ä»½crashæŠ¥å‘Šçš„æœ‰è¶£ä¹‹å¤„åœ¨äºå¼‚å¸¸ä»£ç ï¼šâ€œ0x8badf00dâ€ï¼Œå³â€œate bad foodâ€ã€‚<br>å¦‚æœè¯´ç‰¹å®šçš„UIäº‹ä»¶æ¯”è¾ƒæŠ½è±¡ï¼Œé‚£ä¹ˆç”¨ä»£ç æ¥ç›´æ¥æè¿°çš„è¯ï¼Œå¯¹åº”çš„å°±æ˜¯ï¼ˆåˆ›å»ºä¸€ä¸ªå·¥ç¨‹æ—¶Xcodeè‡ªåŠ¨ç”Ÿæˆçš„ï¼‰UIApplicationDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</div><div class="line">    return YES;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)applicationWillResignActive:(UIApplication *)application &#123;</div><div class="line">    // Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.</div><div class="line">    // Use this method to pause ongoing tasks, disable timers, and throttle down OpenGL ES frame rates. Games should use this method to pause the game.</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)applicationDidEnterBackground:(UIApplication *)application &#123;</div><div class="line">    // Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.</div><div class="line">    // If your application supports background execution, this method is called instead of applicationWillTerminate: when the user quits.</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)applicationWillEnterForeground:(UIApplication *)application &#123;</div><div class="line">    // Called as part of the transition from the background to the inactive state; here you can undo many of the changes made on entering the background.</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)applicationDidBecomeActive:(UIApplication *)application &#123;</div><div class="line">    // Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)applicationWillTerminate:(UIApplication *)application &#123;</div><div class="line">    // Called when the application is about to terminate. Save data if appropriate. See also applicationDidEnterBackground:.</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰€ä»¥å½“é‡åˆ°Watchdogæ—¥å¿—æ—¶ï¼Œå¯ä»¥æ£€æŸ¥ä¸‹ä¸Šé¢å‡ ä¸ªæ–¹æ³•æ˜¯å¦æœ‰æ¯”è¾ƒé‡çš„é˜»å¡UIçš„åŠ¨ä½œã€‚</p>
<p><a href="https://developer.apple.com/library/ios/qa/qa1693/_index.html" target="_blank" rel="external"> <strong><em>QA1693ï¼šSynchronous Networking On The Main Thread</em></strong> </a> ä¸¾çš„ä¾‹å­å°±æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡ŒåŒæ­¥ç½‘ç»œè¯·æ±‚ã€‚å¦‚æœæˆ‘ä»¬æ˜¯åœ¨å…¬å¸çš„Wifiç¯å¢ƒä¸‹ä½¿ç”¨åˆ™ä¸€åˆ‡é¡ºåˆ©ï¼Œä½†å½“åº”ç”¨ç¨‹åºå‘å¸ƒå‡ºå»é¢å‘å¾ˆå¤§èŒƒå›´çš„ç”¨æˆ·ï¼Œåœ¨å„ç§ç½‘ç»œç¯å¢ƒä¸‹è¿è¡Œï¼Œåˆ™ä¸å¯é¿å…åœ°ä¼šå‡ºç°ä¸€ç‰‡Watchdogè¶…æ—¶æŠ¥å‘Šã€‚<br>å¦ä¸€ç§å¯èƒ½å‡ºç°é—®é¢˜çš„åœºæ™¯å°±æ˜¯æ•°æ®é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹è¿›è¡Œçš„æ•°æ®åº“ç‰ˆæœ¬è¿ç§»ï¼ˆåŒæ ·æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šï¼‰ã€‚</p>
<h4 id="å¤±å»äº†-cancel-çš„æœºä¼šï¼š"><a href="#å¤±å»äº†-cancel-çš„æœºä¼šï¼š" class="headerlink" title="å¤±å»äº† cancel çš„æœºä¼šï¼š"></a>å¤±å»äº† cancel çš„æœºä¼šï¼š</h4><p>ä¸èƒ½åƒå¼‚æ­¥é‚£æ ·è¿›è¡Œä¸‹é¢çš„æ“ä½œï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-(IBAction)cancelUpload:(id)sender &#123;</div><div class="line">    if (_uploadTask.state == NSURLSessionTaskStateRunning) &#123;</div><div class="line">        [_uploadTask cancel];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <a href="http://blog.csdn.net/jasonblog/article/details/19031517" target="_blank" rel="external">ã€ŠiOSåº”ç”¨çš„crashæ—¥å¿—çš„åˆ†æåŸºç¡€ã€‹</a> </p>
<p>å‚è€ƒé“¾æ¥ï¼š <a href="https://github.com/ParsePlatform/Parse-SDK-iOS-OSX" target="_blank" rel="external">GitHub:Parse-SDK-iOS-OSXæºç </a> </p>
<hr>
<p>æ”¯æŒåŸåˆ›ï¼š<a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md" target="_blank" rel="external"><strong><em>Parseæºç æµ…æç³»åˆ—ï¼ˆä¸€ï¼‰â€”Parseçš„åº•å±‚å¤šçº¿ç¨‹å¤„ç†æ€è·¯ï¼šGCDé«˜çº§ç”¨æ³•</em></strong></a> </p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/2016/09/gcd-base.html" rel="next" title="GCD åŸºç¡€ç¯‡">
                <i class="fa fa-chevron-left"></i> GCD åŸºç¡€ç¯‡
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="/blog/2016/09/gcd-advanced.html"
           data-title="Parseçš„åº•å±‚å¤šçº¿ç¨‹å¤„ç†æ€è·¯ï¼šGCDé«˜çº§ç”¨æ³•" data-url="http://mkiltech.com//blog/2016/09/gcd-advanced.html">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="MKIL" />
          <p class="site-author-name" itemprop="name">MKIL</p>
          <p class="site-description motion-element" itemprop="description">Mkil èš‚èš</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ymkil" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Parse-iOS-SDKä»‹ç»"><span class="nav-number">1.</span> <span class="nav-text">Parse-iOS-SDKä»‹ç»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parse-çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»"><span class="nav-number">2.</span> <span class="nav-text">Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parse-çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€å®ç°ä»‹ç»"><span class="nav-number">3.</span> <span class="nav-text">Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€å®ç°ä»‹ç»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dispatch-Source-çš„ä½¿ç”¨æ­¥éª¤"><span class="nav-number">4.</span> <span class="nav-text">Dispatch Source çš„ä½¿ç”¨æ­¥éª¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªDispatch-Source"><span class="nav-number">4.1.</span> <span class="nav-text">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªDispatch Source</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç¬¬äºŒæ­¥ï¼šåˆ›å»ºDispatch-Sourceçš„äº‹ä»¶å¤„ç†æ–¹æ³•"><span class="nav-number">4.2.</span> <span class="nav-text">ç¬¬äºŒæ­¥ï¼šåˆ›å»ºDispatch Sourceçš„äº‹ä»¶å¤„ç†æ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç¬¬ä¸‰æ­¥ï¼šå¤„ç†Dispatch-Sourceçš„æš‚åœä¸æ¢å¤æ“ä½œ"><span class="nav-number">4.3.</span> <span class="nav-text">ç¬¬ä¸‰æ­¥ï¼šå¤„ç†Dispatch Sourceçš„æš‚åœä¸æ¢å¤æ“ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç¬¬å››æ­¥ï¼šå‘Dispatch-Sourceå‘é€äº‹ä»¶"><span class="nav-number">4.4.</span> <span class="nav-text">ç¬¬å››æ­¥ï¼šå‘Dispatch Sourceå‘é€äº‹ä»¶</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GCDçœŸçš„ä¸èƒ½åƒOperationQueueé‚£æ ·ç»ˆæ­¢ä»»åŠ¡ï¼Ÿ"><span class="nav-number"></span> <span class="nav-text">GCDçœŸçš„ä¸èƒ½åƒOperationQueueé‚£æ ·ç»ˆæ­¢ä»»åŠ¡ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®Œæ•´ä¾‹å­Demo1ï¼šè®©-Dispatch-Source-â€œå¸®â€-Dispatch-Queue-å®ç°æš‚åœå’Œæ¢å¤åŠŸèƒ½"><span class="nav-number">0.1.</span> <span class="nav-text">å®Œæ•´ä¾‹å­Demo1ï¼šè®© Dispatch Source â€œå¸®â€ Dispatch Queue å®ç°æš‚åœå’Œæ¢å¤åŠŸèƒ½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ"><span class="nav-number">0.2.</span> <span class="nav-text">DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dispatch-Source-ä¸-Dispatch-Queue-ä¸¤è€…åœ¨çº¿ç¨‹æ‰§è¡Œä¸Šçš„å…³ç³»"><span class="nav-number">0.3.</span> <span class="nav-text">Dispatch Source ä¸ Dispatch Queue ä¸¤è€…åœ¨çº¿ç¨‹æ‰§è¡Œä¸Šçš„å…³ç³»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®©-Dispatch-Source-ä¸-Dispatch-Queue-åŒæ—¶å®ç°æš‚åœå’Œæ¢å¤"><span class="nav-number">0.4.</span> <span class="nav-text">è®© Dispatch Source ä¸ Dispatch Queue åŒæ—¶å®ç°æš‚åœå’Œæ¢å¤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parse-â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œçš„ä»£ç æ‘˜å½•"><span class="nav-number">1.</span> <span class="nav-text">Parse â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œçš„ä»£ç æ‘˜å½•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dispatch-Semaphore-ä¿¡å·é‡"><span class="nav-number">2.</span> <span class="nav-text">Dispatch Semaphore ä¿¡å·é‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•"><span class="nav-number">2.1.</span> <span class="nav-text">åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨Dispatch-Semaphoreæ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡"><span class="nav-number">2.2.</span> <span class="nav-text">ä½¿ç”¨Dispatch Semaphoreæ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸º-NSURLSession-æ·»åŠ åŒæ­¥æ–¹æ³•"><span class="nav-number">2.3.</span> <span class="nav-text">ä¸º  NSURLSession æ·»åŠ åŒæ­¥æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å¯¼è‡´Watchdogè¶…æ—¶"><span class="nav-number">2.3.1.</span> <span class="nav-text">å¯¼è‡´Watchdogè¶…æ—¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤±å»äº†-cancel-çš„æœºä¼šï¼š"><span class="nav-number">2.3.2.</span> <span class="nav-text">å¤±å»äº† cancel çš„æœºä¼šï¼š</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">MKIL</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"mkil"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
